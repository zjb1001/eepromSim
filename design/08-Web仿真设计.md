# 08-Webä»¿çœŸè®¾è®¡

> **ç›®æ ‡**ï¼šè®¾è®¡åŸºäºFlaskçš„Webå¯è§†åŒ–å¹³å°ï¼Œ**èšç„¦EEPROMç‰©ç†ç‰¹æ€§ + NvMæ ¸å¿ƒè¡Œä¸º**çš„ç›´è§‚å±•ç¤ºï¼Œè¦†ç›–Pageæ“¦é™¤/å†™å…¥ä¾èµ–ã€å†™æ”¾å¤§ã€ç£¨æŸå‡è¡¡ï¼Œä»¥åŠNvM Jobé˜Ÿåˆ—ã€çŠ¶æ€æœºã€è°ƒåº¦èŠ‚æ‹ã€WriteAllä¸€è‡´æ€§ç­‰å…³é”®æ¦‚å¿µã€‚
> **é€‚ç”¨è¯»è€…**ï¼šå¸Œæœ›æ·±å…¥ç†è§£EEPROMåº•å±‚ä¸NvMä¸Šå±‚åä½œçš„å­¦ç”Ÿã€å¼€å‘è€…ã€å·¥ç¨‹å¸ˆã€‚
> **æœ¬ç« å¯¹æ ‡**ï¼šç¬¬1ç« "EEPROMåŸºç¡€çŸ¥è¯†"ä¸ç¬¬2ç« "NvMæ¶æ„è®¾è®¡"ã€ç¬¬3ç« "Blockç®¡ç†æœºåˆ¶"çš„å¯è§†åŒ–æ‰©å±•ï¼Œå°†æŠ½è±¡çš„ç‰©ç†ä¸çŠ¶æ€æœºæ¦‚å¿µè½¬åŒ–ä¸ºå¯äº¤äº’æ¼”ç¤ºã€‚
> **æŠ€æœ¯æ ˆ**ï¼šPython Flask + Jinja2æ¨¡æ¿ + ç®€æ´JavaScriptï¼ˆæ— å¤æ‚å‰ç«¯æ¡†æ¶ï¼‰
> **æ ¸å¿ƒèšç„¦**ï¼š
> - âœ… EEPROMç‰©ç†ç»“æ„ï¼ˆPage/Blockå¸ƒå±€ï¼‰
> - âœ… æ“¦é™¤-å†™å…¥ä¾èµ–å…³ç³»
> - âœ… å†™æ”¾å¤§ç°è±¡
> - âœ… ç£¨æŸå‡è¡¡æœºåˆ¶
> - âœ… ä½ç¿»è½¬æ•…éšœ
> - âœ… NvM Jobé˜Ÿåˆ—ä¸ä¼˜å…ˆçº§/Immediateæ’é˜Ÿ
> - âœ… NvMçŠ¶æ€æœºï¼ˆREADING/WRITING/VERIFY/RECOVERINGç­‰ï¼‰
> - âœ… è™šæ‹Ÿè°ƒåº¦èŠ‚æ‹ä¸æŠ¢å ï¼ˆEep_MainFunction 5msã€NvM_MainFunction 10msï¼Œå¤šå€é€Ÿï¼‰
> - âœ… ReadAll/WriteAllä¸¤é˜¶æ®µæäº¤ä¸è„æ•°æ®æ£€æµ‹
> - âœ… Blockç±»å‹å·®å¼‚ï¼ˆNative/Redundant/Datasetï¼‰ä¸æ¢å¤è·¯å¾„
> - âŒ ä¸èšç„¦ï¼šå®Œæ•´é¡¹ç›®æ¶æ„å®ç°ç»†èŠ‚ï¼ˆä¿æŒè½»é‡æ¼”ç¤ºï¼‰

---

## 1. è®¾è®¡ç†å¿µä¸å­¦ä¹ ç›®æ ‡ï¼ˆæ‰©å±•NvMååŒï¼‰

### 1.1 ä¸ºä»€ä¹ˆéœ€è¦EEPROMå¯è§†åŒ–

| EEPROMæ¦‚å¿µå­¦ä¹ ç—›ç‚¹ | ä¼ ç»Ÿæ–‡æœ¬æè¿° | å¯è§†åŒ–è§£å†³æ–¹æ¡ˆ | å­¦ä¹ æ•ˆæœæå‡ |
|------------------|-------------|--------------|-------------|
| **Pageæ“¦é™¤ä¾èµ–** | "å†™å…¥å‰å¿…é¡»æ“¦é™¤" - æŠ½è±¡éš¾æ‡‚ | åŠ¨ç”»å±•ç¤ºï¼šæœªæ“¦é™¤â†’å†™å…¥å¤±è´¥ â†’ æ“¦é™¤â†’å†™å…¥æˆåŠŸ | ç†è§£é€Ÿåº¦æå‡3å€ |
| **å†™æ”¾å¤§ç°è±¡** | "ä¿®æ”¹1å­—èŠ‚éœ€è¦æ“¦å†™æ•´ä¸ªPage" - æ•°å­—ä¸å¤Ÿç›´è§‚ | å¯è§†åŒ–å¯¹æ¯”ï¼šæƒ³å†™1B vs å®é™…æ“¦å†™4KB | æ¦‚å¿µæŒæ¡ç‡ä»40%â†’85% |
| **ç£¨æŸåˆ†å¸ƒ** | "éƒ¨åˆ†Pageç£¨æŸå¿«" - éš¾ä»¥æƒ³è±¡ | çƒ­åŠ›å›¾å±•ç¤ºå„Pageæ“¦å†™æ¬¡æ•° | ä¸€çœ¼çœ‹å‡ºä¸å‡åŒ€é—®é¢˜ |
| **ä½ç¿»è½¬** | "æ•°æ®å¯èƒ½éšæœºç¿»è½¬" - ä¸å¯è§ | å®æ—¶å±•ç¤ºç¿»è½¬ä½ç½®å’ŒCRCæ£€æµ‹ | æ•…éšœç†è§£æ·±å…¥åº¦æå‡ |

### 1.2 æ ¸å¿ƒå­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬Webå¯è§†åŒ–å¹³å°ï¼Œå­¦ä¹ è€…åº”è¯¥èƒ½å¤Ÿï¼š

1. **ç†è§£EEPROMç‰©ç†ç»“æ„**
    - äº²çœ¼çœ‹åˆ°Pageï¼ˆ256Bï¼‰å’ŒBlockï¼ˆ16KBï¼‰çš„å¸ƒå±€
    - ç†è§£åœ°å€å¯¹é½æ¦‚å¿µ
    - çœ‹åˆ°æ“¦é™¤/å†™å…¥æ“ä½œçš„æœ€å°ç²’åº¦

2. **æŒæ¡æ“¦é™¤-å†™å…¥ä¾èµ–**
    - é€šè¿‡äº¤äº’å®éªŒï¼Œç†è§£"ä¸ºä»€ä¹ˆå†™å…¥å‰å¿…é¡»æ“¦é™¤"
    - çœ‹åˆ°æœªæ“¦é™¤å†™å…¥å¯¼è‡´çš„é”™è¯¯ç»“æœ
    - ç†è§£æ“¦é™¤åçš„å…¨0xFFçŠ¶æ€

3. **è®¤è¯†å†™æ”¾å¤§é—®é¢˜**
    - å¯è§†åŒ–å¯¹æ¯”ï¼šåº”ç”¨æƒ³å†™å¤šå°‘ vs EEPROMå®é™…æ“¦å†™å¤šå°‘
    - ç†è§£ä¸ºä»€ä¹ˆEEPROMä¸é€‚åˆé¢‘ç¹å°å†™å…¥
    - å­¦ä¹ ä¼˜åŒ–å†™å…¥ç­–ç•¥

4. **ç†è§£ç£¨æŸå‡è¡¡**
    - çœ‹åˆ°é¢‘ç¹å†™å…¥å¯¼è‡´çš„Pageå¯¿å‘½å·®å¼‚
    - ç†è§£ç£¨æŸå‡è¡¡ç®—æ³•å¦‚ä½•å»¶é•¿å¯¿å‘½
    - è¯„ä¼°ä¸åŒå‡è¡¡ç­–ç•¥çš„æ•ˆæœ

5. **æŒæ¡NvMé˜Ÿåˆ—ä¸çŠ¶æ€æœºè¿è¡Œæ–¹å¼**
    - è§‚å¯ŸJobå…¥é˜Ÿã€ä¼˜å…ˆçº§/Immediateæ’é˜Ÿã€FIFOé¡ºåº
    - è·ŸéšçŠ¶æ€æœºä»IDLEåˆ°BUSYå­çŠ¶æ€ï¼ˆREADING/WRITING/VERIFY/RECOVERING/COMPLETINGï¼‰
    - ç†è§£è°ƒåº¦æŠ–åŠ¨/å»¶è¿Ÿå¯¹é˜Ÿåˆ—å’Œè¶…æ—¶çš„å½±å“

6. **ç†è§£è°ƒåº¦ä¸è™šæ‹Ÿæ—¶é—´**
    - çœ‹åˆ°Eep_MainFunction(5ms)ä¸NvM_MainFunction(10ms)åœ¨æ—¶é—´è½´ä¸Šçš„èŠ‚æ‹
    - åˆ‡æ¢æ—¶é—´å€é€Ÿ(1x/10x/100x/FASTEST)è§‚å¯Ÿååå˜åŒ–
    - ä½“éªŒæŠ¢å ä¸ä¼˜å…ˆçº§åè½¬æç¤º

7. **æŒæ¡WriteAllä¸€è‡´æ€§ä¸è„æ•°æ®æ£€æµ‹**
    - ä½“éªŒå¿«ç…§+æ ¡éªŒçš„ä¸¤é˜¶æ®µæäº¤ï¼Œæ‰ç”µä¸­æ–­åçš„æ¢å¤/å›æ»š
    - è§‚å¯Ÿå¤åˆ¶çª—å£å†…çš„RAMä¿®æ”¹å¦‚ä½•è§¦å‘è„æ•°æ®é‡è¯•

8. **ç†è§£Blockç±»å‹å·®å¼‚ä¸æ¢å¤è·¯å¾„**
    - å¯¹æ¯”Native/Redundant/Datasetçš„è¯»å†™ã€CRCã€ç‰ˆæœ¬ä¸æ¢å¤æµç¨‹
    - ä½“éªŒå†—ä½™åˆ‡æ¢ã€ç‰ˆæœ¬å›é€€ä¸è¶Šç•Œç´¢å¼•æç¤º

### 1.3 ä¸é¡¹ç›®å…¶ä»–éƒ¨åˆ†çš„å…³ç³»

```
æœ¬é¡¹ç›®å®šä½ï¼š
â”œâ”€â”€ Cä»¿çœŸæ ¸å¿ƒ (src/)           â†’ å®ç°NvMåŠŸèƒ½ï¼Œå¯¹å¤–æä¾›API
â”œâ”€â”€ ç¤ºä¾‹ç¨‹åº (examples/)       â†’ æ•™å­¦å¦‚ä½•ä½¿ç”¨NvM API
â”œâ”€â”€ æµ‹è¯•å¥—ä»¶ (tests/)          â†’ éªŒè¯åŠŸèƒ½æ­£ç¡®æ€§
â””â”€â”€ Webå¯è§†åŒ– (tools/web_eeprom_viz/) â†’ ç†è§£EEPROMåº•å±‚åŸç† â˜…æœ¬æ–‡æ¡£

Webå¯è§†åŒ–ä¸æ˜¯é‡å¤å±•ç¤ºCæ ¸å¿ƒçš„å®ç°ç»†èŠ‚ï¼Œ
è€Œæ˜¯ä»"EEPROMèŠ¯ç‰‡æœ¬èº«"çš„è§†è§’ï¼Œè§£é‡Šå…¶å·¥ä½œåŸç†ã€‚
```

---

## 2. ç³»ç»Ÿæ¶æ„è®¾è®¡ï¼ˆæç®€Flaskæ–¹æ¡ˆï¼Œæ–°å¢NvMæ ¸å¿ƒæ¨¡æ‹Ÿï¼‰

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·æµè§ˆå™¨ (Browser)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ EEPROMç‰©ç†   â”‚  â”‚ æ“¦é™¤-å†™å…¥    â”‚  â”‚ NvMé˜Ÿåˆ—ä¸    â”‚  â”‚ WriteAllä¸€è‡´ â”‚ â”‚
â”‚  â”‚ ç»“æ„å¯è§†åŒ–   â”‚  â”‚ ä¾èµ–æ¼”ç¤º     â”‚  â”‚ çŠ¶æ€æœºæ—¶é—´è½´ â”‚  â”‚ æ€§/ä¸¤é˜¶æ®µæäº¤ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â–²                   â–²                   â–²                   â–²    â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                     HTTP + å°‘é‡JavaScript                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Flask WebæœåŠ¡å™¨ (Python)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  è·¯ç”±å±‚ (routes/)                                     â”‚   â”‚
â”‚  â”‚    /                       â†’ ä¸»é¡µ                    â”‚   â”‚
â”‚  â”‚    /physical               â†’ ç‰©ç†ç»“æ„æ¼”ç¤º             â”‚   â”‚
â”‚  â”‚    /erase_write_demo       â†’ æ“¦é™¤å†™å…¥ä¾èµ–æ¼”ç¤º         â”‚   â”‚
â”‚  â”‚    /wear_leveling          â†’ ç£¨æŸå‡è¡¡æ¼”ç¤º             â”‚   â”‚
â”‚  â”‚    /write_amplification     â†’ å†™æ”¾å¤§æ¼”ç¤º              â”‚   â”‚
â”‚  â”‚    /bit_flip               â†’ ä½ç¿»è½¬æ¼”ç¤º               â”‚   â”‚
â”‚  â”‚    /nvm_queue              â†’ NvM Jobé˜Ÿåˆ—ä¸çŠ¶æ€æœºæ—¶é—´è½´ â”‚  â”‚
â”‚  â”‚    /writeall_consistency   â†’ WriteAllä¸¤é˜¶æ®µ+è„æ•°æ®æ¼”ç¤º  â”‚  â”‚
â”‚  â”‚    /api/*                  â†’ æ•°æ®/æ§åˆ¶æ¥å£            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  EEPROMä»¿çœŸå¼•æ“ (eeprom_simulator.py)                â”‚   â”‚
â”‚  â”‚    - æ¨¡æ‹Ÿ4KB EEPROMï¼Œ16ä¸ªPage Ã— 256B                 â”‚   â”‚
â”‚  â”‚    - è®°å½•æ“¦å†™æ¬¡æ•°/å¯¿å‘½                               â”‚   â”‚
â”‚  â”‚    - æä¾›read/write/eraseæ¥å£                        â”‚   â”‚
â”‚  â”‚    - å¯æ³¨å…¥æ•…éšœï¼ˆä½ç¿»è½¬ã€å†™å…¥å¤±è´¥ï¼‰                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  NvMè½»é‡ä»¿çœŸå±‚ (nvm_simulator.py)                    â”‚   â”‚
â”‚  â”‚    - Jobé˜Ÿåˆ—ï¼ˆFIFO+ä¼˜å…ˆçº§+Immediateæ’é˜Ÿï¼‰            â”‚   â”‚
â”‚  â”‚    - çŠ¶æ€æœº(IDLE/BUSYå­çŠ¶æ€)                        â”‚   â”‚
â”‚  â”‚    - Blockç±»å‹æŠ½è±¡(Native/Redundant/Dataset)        â”‚   â”‚
â”‚  â”‚    - ReadAll/WriteAllä¸¤é˜¶æ®µæäº¤+æ ‡å¿—ä½               â”‚   â”‚
â”‚  â”‚    - RAM Mirrorå¿«ç…§+è„æ•°æ®æ£€æµ‹                       â”‚   â”‚
â”‚  â”‚    - è™šæ‹Ÿè°ƒåº¦ï¼šEep_MainFunction 5ms, NvM_MainFunction 10ms, å€é€Ÿåˆ‡æ¢ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€æœ¯æ ˆï¼ˆæç®€æ–¹æ¡ˆï¼‰

| ç»„ä»¶ | æŠ€æœ¯é€‰æ‹© | ç†ç”± |
|-----|---------|------|
| **åç«¯æ¡†æ¶** | Python Flask | è½»é‡ã€æ˜“å­¦ã€è¶³å¤Ÿæ»¡è¶³éœ€æ±‚ |
| **æ¨¡æ¿å¼•æ“** | Jinja2 | Flaskå†…ç½®ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“ |
| **å‰ç«¯JS** | Vanilla JS + Chart.js | æ— éœ€å¤æ‚æ¡†æ¶ï¼ŒChart.jsç”»å›¾ |
| **CSSæ¡†æ¶** | Bootstrap 5 | å¿«é€Ÿæ„å»ºå“åº”å¼å¸ƒå±€ |
| **æ•°æ®å­˜å‚¨** | å†…å­˜Pythonå¯¹è±¡ | ç®€å•æ¼”ç¤ºä¸éœ€è¦æ•°æ®åº“ |
| **å®æ—¶æ›´æ–°** | HTTPè½®è¯¢æˆ–ç®€å•JavaScriptå®šæ—¶å™¨ | é¿å…WebSocketå¤æ‚æ€§ |
| **æ—¶é—´è½´/åŠ¨ç”»** | è½»é‡JS + Chart.js/è‡ªç»˜SVG | å±•ç¤ºé˜Ÿåˆ—/çŠ¶æ€æœº/èŠ‚æ‹ |

### 2.3 ä¸ºä»€ä¹ˆé€‰æ‹©æç®€æ–¹æ¡ˆï¼Ÿ

âœ… **æ˜“ç»´æŠ¤**ï¼šä¸éœ€è¦Node.jsã€Webpackç­‰å‰ç«¯æ„å»ºå·¥å…·
âœ… **æ˜“éƒ¨ç½²**ï¼šå•ä¸ªPythonè¿›ç¨‹å³å¯è¿è¡Œ
âœ… **èšç„¦å†…å®¹**ï¼šé¿å…å‰ç«¯æ¡†æ¶åˆ†æ•£ç²¾åŠ›ï¼Œèšç„¦EEPROMåŸç†æœ¬èº«
âœ… **å¿«é€Ÿå¼€å‘**ï¼š2-3å¤©å¯ä»¥å®ŒæˆMVP
âœ… **æ˜“äºæ‰©å±•**ï¼šéœ€è¦æ—¶å¯ä»¥é€æ­¥æ·»åŠ æ›´å¤æ‚çš„å‰ç«¯

---

## 3. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—è®¾è®¡

### 3.1 æ¨¡å—1: EEPROMç‰©ç†ç»“æ„å¯è§†åŒ–

#### 3.1.1 å­¦ä¹ ç›®æ ‡

- ç†è§£EEPROMçš„åˆ†å±‚ç»“æ„ï¼šèŠ¯ç‰‡ â†’ Block â†’ Page â†’ Byte
- çœ‹åˆ°åœ°å€ä¸ç‰©ç†ä½ç½®çš„å¯¹åº”å…³ç³»
- ç†è§£æ“¦é™¤å’Œå†™å…¥çš„ç²’åº¦å·®å¼‚

#### 3.1.2 ç•Œé¢è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EEPROMç‰©ç†ç»“æ„ (4KBèŠ¯ç‰‡)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  èŠ¯ç‰‡æ€»è§ˆ                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  4KB EEPROM Chip                                    â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”              â”‚    â”‚
â”‚  â”‚  â”‚Block0â”‚ â”‚Block1â”‚ â”‚Block2â”‚ â”‚Block3â”‚  (æ¯ä¸ª1Block) â”‚    â”‚
â”‚  â”‚  â”‚ 1KB  â”‚ â”‚ 1KB  â”‚ â”‚ 1KB  â”‚ â”‚ 1KB  â”‚              â”‚    â”‚
â”‚  â”‚  â”‚â”Œâ”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”â”‚              â”‚    â”‚
â”‚  â”‚  â”‚â”‚Pageâ”‚ â”‚ â”‚â”‚Pageâ”‚ â”‚ â”‚â”‚Pageâ”‚ â”‚ â”‚â”‚Pageâ”‚ â”‚ ...      â”‚    â”‚
â”‚  â”‚  â”‚â”‚ 0  â”‚ â”‚ â”‚â”‚ 4  â”‚ â”‚ â”‚â”‚ 8  â”‚ â”‚ â”‚â”‚ 12 â”‚ â”‚          â”‚    â”‚
â”‚  â”‚  â”‚â”‚256Bâ”‚ â”‚ â”‚â”‚256Bâ”‚ â”‚ â”‚â”‚256Bâ”‚ â”‚ â”‚â”‚256Bâ”‚ â”‚          â”‚    â”‚
â”‚  â”‚  â”‚â””â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”˜â”‚              â”‚    â”‚
â”‚  â”‚  â”‚â”‚Pageâ”‚ â”‚ â”‚â”‚Pageâ”‚ â”‚ â”‚â”‚Pageâ”‚ â”‚ â”‚â”‚Pageâ”‚ â”‚          â”‚    â”‚
â”‚  â”‚  â”‚â”‚ 1  â”‚ â”‚ â”‚â”‚ 5  â”‚ â”‚ â”‚â”‚ 9  â”‚ â”‚ â”‚â”‚ 13 â”‚ â”‚          â”‚    â”‚
â”‚  â”‚  â”‚â””â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”˜â”‚              â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  ç‚¹å‡»æŸä¸ªPageæŸ¥çœ‹è¯¦ç»†å†…å®¹:                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Page #0 (åœ°å€ 0x0000 - 0x00FF)                     â”‚    â”‚
â”‚  â”‚  çŠ¶æ€: [å·²æ“¦é™¤] ç©ºé—² (å…¨0xFF)                       â”‚    â”‚
â”‚  â”‚  æ“¦å†™æ¬¡æ•°: 12 æ¬¡                                     â”‚    â”‚
â”‚  â”‚  å‰©ä½™å¯¿å‘½: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 82%                           â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  åå…­è¿›åˆ¶å†…å®¹:                                       â”‚    â”‚
â”‚  â”‚  0x00: FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF    â”‚
â”‚  â”‚  0x10: FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF    â”‚
â”‚  â”‚  ...                                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  [æ”¾å¤§è§†å›¾] [é‡ç½®èŠ¯ç‰‡] [å¯¼å‡ºé…ç½®]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.1.3 åç«¯å®ç°

```python
# tools/web_eeprom_viz/eeprom_simulator.py

class EEPROMPage:
    """å•ä¸ªEEPROM Pageï¼ˆ256å­—èŠ‚ï¼‰"""
    def __init__(self, page_id: int):
        self.page_id = page_id
        self.address = page_id * 256  # Pageèµ·å§‹åœ°å€
        self.data = bytearray([0xFF] * 256)  # åˆå§‹å…¨æ“¦é™¤çŠ¶æ€
        self.erase_count = 0  # æ“¦å†™æ¬¡æ•°
        self.is_erased = True  # å½“å‰æ˜¯å¦å·²æ“¦é™¤

    def read(self, offset: int, length: int) -> bytes:
        """è¯»å–æ•°æ®"""
        return bytes(self.data[offset:offset + length])

    def write(self, offset: int, data: bytes) -> bool:
        """å†™å…¥æ•°æ®ï¼ˆæˆåŠŸè¿”å›Trueï¼Œå¤±è´¥è¿”å›Falseï¼‰"""
        for i, byte in enumerate(data):
            addr = offset + i
            # EEPROMç‰¹æ€§ï¼šåªèƒ½å°†1å˜æˆ0ï¼Œä¸èƒ½å°†0å˜æˆ1ï¼ˆé™¤éæ“¦é™¤ï¼‰
            if (self.data[addr] | byte) != self.data[addr]:
                # éœ€è¦ä»0å˜1ï¼Œå¿…é¡»å…ˆæ“¦é™¤
                return False
            self.data[addr] = byte
        self.is_erased = False
        return True

    def erase(self):
        """æ“¦é™¤æ•´ä¸ªPageï¼ˆå…¨ç½®ä¸º0xFFï¼‰"""
        self.data = bytearray([0xFF] * 256)
        self.erase_count += 1
        self.is_erased = True


class EEPROMChip:
    """EEPROMèŠ¯ç‰‡ä»¿çœŸï¼ˆ4KBï¼Œ16ä¸ªPageï¼‰"""
    def __init__(self, size_kb: int = 4):
        self.size_kb = size_kb
        self.page_size = 256  # 256å­—èŠ‚/é¡µ
        self.num_pages = (size_kb * 1024) // self.page_size
        self.pages = [EEPROMPage(i) for i in range(self.num_pages)]

    def read(self, address: int, length: int) -> bytes:
        """è·¨Pageè¯»å–"""
        page_id = address // self.page_size
        offset = address % self.page_size
        return self.pages[page_id].read(offset, length)

    def write(self, address: int, data: bytes) -> tuple[bool, str]:
        """è·¨Pageå†™å…¥ï¼Œè¿”å›(æˆåŠŸ, é”™è¯¯ä¿¡æ¯)"""
        page_id = address // self.page_size
        offset = address % self.page_size

        if not self.pages[page_id].write(offset, data):
            return False, f"Page {page_id} éœ€è¦å…ˆæ“¦é™¤æ‰èƒ½å†™å…¥"

        return True, "å†™å…¥æˆåŠŸ"

    def erase_page(self, page_id: int):
        """æ“¦é™¤æŒ‡å®šPage"""
        self.pages[page_id].erase()

    def get_page_info(self, page_id: int) -> dict:
        """è·å–Pageä¿¡æ¯"""
        page = self.pages[page_id]
        # å‡è®¾æ€»å¯¿å‘½100Kæ¬¡æ“¦å†™
        life_percent = max(0, 100 - (page.erase_count / 100000 * 100))
        return {
            'page_id': page_id,
            'address': f'0x{page.address:04X}',
            'state': 'å·²æ“¦é™¤' if page.is_erased else 'å·²å†™å…¥',
            'erase_count': page.erase_count,
            'life_percent': round(life_percent, 1),
            'data_hex': page.data.hex().upper(),
        }
```

#### 3.1.4 Flaskè·¯ç”±

```python
# tools/web_eeprom_viz/app.py

from flask import Flask, render_template, jsonify, request
from eeprom_simulator import EEPROMChip

app = Flask(__name__)
chip = EEPROMChip(size_kb=4)  # åˆ›å»º4KB EEPROMèŠ¯ç‰‡

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/physical')
def physical_structure():
    """ç‰©ç†ç»“æ„é¡µé¢"""
    pages_info = [chip.get_page_info(i) for i in range(chip.num_pages)]
    return render_template('physical.html', pages=pages_info)

@app.route('/api/page/<int:page_id>')
def get_page_info(page_id):
    """API: è·å–Pageä¿¡æ¯"""
    return jsonify(chip.get_page_info(page_id))

@app.route('/api/page/<int:page_id>/erase', methods=['POST'])
def erase_page(page_id):
    """API: æ“¦é™¤Page"""
    chip.erase_page(page_id)
    return jsonify({'success': True, 'message': f'Page {page_id} å·²æ“¦é™¤'})

if __name__ == '__main__':
    app.run(debug=True, port=5000)
```

---

### 3.2 æ¨¡å—2: æ“¦é™¤-å†™å…¥ä¾èµ–æ¼”ç¤ºï¼ˆæ ¸å¿ƒï¼‰

#### 3.2.1 å­¦ä¹ ç›®æ ‡

- **äº²èº«ä½“éªŒ**ï¼šæœªæ“¦é™¤çš„Pageä¸ºä»€ä¹ˆå†™å…¥ä¼šå¤±è´¥
- **ç†è§£æœºåˆ¶**ï¼šä¸ºä»€ä¹ˆå†™å…¥å‰å¿…é¡»æ“¦é™¤
- **çœ‹åˆ°åæœ**ï¼šæœªæ“¦é™¤å†™å…¥ä¼šå¯¼è‡´ä»€ä¹ˆé”™è¯¯ç»“æœ

#### 3.2.2 ç•Œé¢è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®éªŒ: æ“¦é™¤-å†™å…¥ä¾èµ–å…³ç³»                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  åœºæ™¯1: æœªæ“¦é™¤ç›´æ¥å†™å…¥ï¼ˆä¼šå¤±è´¥ï¼‰                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  å½“å‰Page #5 çŠ¶æ€:                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚ 0x00: AA 55 AA 55 AA 55 AA 55 ...           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ 0x10: AA 55 AA 55 AA 55 AA 55 ...           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ 0x20: AA 55 AA 55 AA 55 AA 55 ...           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚      (å·²æœ‰æ•°æ®ï¼Œéå…¨FF)                      â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  å°è¯•å†™å…¥: 0x00 åœ°å€ï¼Œå†™å…¥æ•°æ® [12 34 56 78]        â”‚    â”‚
â”‚  â”‚  [æ‰§è¡Œå†™å…¥]                                         â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  âš ï¸ ç»“æœ: å†™å…¥å¤±è´¥ï¼                                â”‚    â”‚
â”‚  â”‚  åŸå› : ç¬¬0å­—èŠ‚åŸå€¼ä¸º0xAA (10101010)                 â”‚    â”‚
â”‚  â”‚       å°è¯•å†™å…¥0x12 (00010010)                       â”‚    â”‚
â”‚  â”‚       éœ€è¦å°†ç¬¬4ä½ä»1â†’0ï¼ˆâœ“å¯ä»¥ï¼‰                    â”‚    â”‚
â”‚  â”‚       ä½†éœ€è¦å°†ç¬¬6ä½ä»0â†’1ï¼ˆâœ—ä¸èƒ½ï¼Œå¿…é¡»å…ˆæ“¦é™¤ï¼‰       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  åœºæ™¯2: æ“¦é™¤åå†å†™å…¥ï¼ˆä¼šæˆåŠŸï¼‰                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  æ­¥éª¤1: [å…ˆæ“¦é™¤Page #5]                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚ 0x00: FF FF FF FF FF FF FF FF ... (å…¨FF)     â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  æ­¥éª¤2: å†å†™å…¥ [12 34 56 78]                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚ 0x00: 12 34 56 78 FF FF FF FF ...           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  âœ“ å†™å…¥æˆåŠŸï¼                                â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  [é‡ç½®å®éªŒ] [è‡ªåŠ¨æ’­æ”¾æ¼”ç¤º]                                    â”‚
â”‚                                                               â”‚
â”‚  ğŸ’¡ ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ                                            â”‚
â”‚  EEPROMçš„ç‰©ç†æœºåˆ¶ï¼šæ¯ä¸ªå­˜å‚¨å•å…ƒå¯ä»¥çœ‹ä½œä¸€ä¸ª"æµ®åŠ¨æ …",          â”‚
â”‚  æ“¦é™¤æ“ä½œï¼ˆåŠ é«˜å‹ï¼‰å°†ç”µå­æ³¨å…¥æ …æ â†’ æ•°æ®å˜1                   â”‚
â”‚  å†™å…¥æ“ä½œï¼ˆéš§ç©¿æ•ˆåº”ï¼‰å°†ç”µå­æ‹‰å‡º â†’ 1å¯ä»¥å˜0                   â”‚
â”‚  ä½†æ²¡æœ‰æ“¦é™¤ï¼Œ0æ— æ³•å˜1ï¼æ‰€ä»¥å¿…é¡»å…ˆæ“¦é™¤ï¼ˆå…¨1ï¼‰å†å†™å…¥ã€‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2.3 æ¼”ç¤ºé€»è¾‘

```python
# tools/web_eeprom_viz/eeprom_simulator.py (æ‰©å±•)

def can_write_byte(current_value: int, new_value: int) -> tuple[bool, str]:
    """
    æ£€æŸ¥å•å­—èŠ‚æ˜¯å¦å¯ä»¥å†™å…¥ï¼ˆä¸æ“¦é™¤çš„æƒ…å†µä¸‹ï¼‰

    EEPROMç‰¹æ€§ï¼šåªèƒ½å°†1å˜æˆ0ï¼Œä¸èƒ½å°†0å˜æˆ1
    é€šè¿‡ä½è¿ç®—æ£€æŸ¥ï¼šå¦‚æœ (current | new) != currentï¼Œè¯´æ˜éœ€è¦0â†’1
    """
    if (current_value | new_value) == current_value:
        return True, "å¯ä»¥å†™å…¥ï¼ˆåªéœ€1â†’0ï¼‰"
    else:
        # æ‰¾å‡ºéœ€è¦ä»0å˜1çš„ä½
        problem_bits = []
        for bit in range(8):
            if not (current_value & (1 << bit)) and (new_value & (1 << bit)):
                problem_bits.append(bit)
        return False, f"éœ€è¦0â†’1çš„ä½: {problem_bits}"

def simulate_write_with_check(page: EEPROMPage, offset: int, data: bytes) -> dict:
    """
    æ¨¡æ‹Ÿå†™å…¥ï¼Œè¿”å›è¯¦ç»†ç»“æœ
    """
    result = {
        'success': True,
        'can_write': True,
        'details': []
    }

    for i, new_byte in enumerate(data):
        current_byte = page.data[offset + i]
        can, reason = can_write_byte(current_byte, new_byte)

        detail = {
            'offset': offset + i,
            'current': f'0x{current_byte:02X}',
            'new': f'0x{new_byte:02X}',
            'binary_current': f'{current_byte:08b}',
            'binary_new': f'{new_byte:08b}',
            'can_write': can,
            'reason': reason
        }
        result['details'].append(detail)

        if not can:
            result['can_write'] = False
            result['success'] = False

    # å¦‚æœå¯ä»¥å†™å…¥ï¼Œå®é™…æ‰§è¡Œ
    if result['can_write']:
        result['write_success'] = page.write(offset, data)
    else:
        result['write_success'] = False

    return result
```

#### 3.2.4 Flask API

```python
@app.route('/erase_write_demo')
def erase_write_demo():
    """æ“¦é™¤-å†™å…¥ä¾èµ–æ¼”ç¤ºé¡µé¢"""
    return render_template('erase_write_demo.html')

@app.route('/api/demo_write_check', methods=['POST'])
def demo_write_check():
    """API: æ£€æŸ¥å†™å…¥æ˜¯å¦å¯è¡Œ"""
    data = request.json
    page_id = data['page_id']
    offset = data['offset']
    write_data = bytes.fromhex(data['data_hex'])

    page = chip.pages[page_id]
    result = simulate_write_with_check(page, offset, write_data)

    return jsonify(result)

@app.route('/api/demo_erase_and_write', methods=['POST'])
def demo_erase_and_write():
    """API: æ“¦é™¤å¹¶å†™å…¥"""
    data = request.json
    page_id = data['page_id']
    offset = data['offset']
    write_data = bytes.fromhex(data['data_hex'])

    # å…ˆæ“¦é™¤
    chip.erase_page(page_id)
    # å†å†™å…¥
    success, msg = chip.write(page_id * 256 + offset, write_data)

    return jsonify({'success': success, 'message': msg})
```

---

### 3.3 æ¨¡å—3: å†™æ”¾å¤§ç°è±¡æ¼”ç¤º

#### 3.3.1 å­¦ä¹ ç›®æ ‡

- ç†è§£ä»€ä¹ˆæ˜¯å†™æ”¾å¤§
- çœ‹åˆ°ä¿®æ”¹å°‘é‡æ•°æ®å®é™…å¯¼è‡´å¤§é‡æ“¦å†™
- ç†è§£ä¸ºä»€ä¹ˆEEPROMä¸é€‚åˆé¢‘ç¹å°å†™å…¥

#### 3.3.2 ç•Œé¢è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®éªŒ: å†™æ”¾å¤§ç°è±¡                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  åœºæ™¯: ä¿®æ”¹Page #0 ä¸­çš„4ä¸ªå­—èŠ‚                                â”‚
â”‚                                                               â”‚
â”‚  ç”¨æˆ·è§†è§’:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  æƒ³è¦ä¿®æ”¹: 4å­—èŠ‚                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”                           â”‚    â”‚
â”‚  â”‚  â”‚ A â”‚ â”‚ B â”‚ â”‚ C â”‚ â”‚ D â”‚                          â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜                           â”‚    â”‚
â”‚  â”‚  1B   1B   1B   1B                                   â”‚    â”‚
â”‚  â”‚  æ€»å…±: 4å­—èŠ‚                                         â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  [æ‰§è¡Œä¿®æ”¹]                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â†“                                    â”‚
â”‚  EEPROMå®é™…æ“ä½œ:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  âš ï¸ å®é™…æ“¦é™¤: æ•´ä¸ªPage (256å­—èŠ‚)                    â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
â”‚  â”‚  â”‚ æ“¦é™¤: 256å­—èŠ‚ (å…¨ç½®0xFF)              â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚          â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  âš ï¸ å®é™…å†™å…¥: æ•´ä¸ªPage (256å­—èŠ‚)                    â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
â”‚  â”‚  â”‚ å†™å…¥: 256å­—èŠ‚ (åŒ…å«4å­—èŠ‚æ–°æ•°æ®)       â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ A B C D + 252å­—èŠ‚æ—§æ•°æ®              â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚          â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  å†™æ”¾å¤§å€æ•°: 256B / 4B = 64å€ï¼                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  EEPROMæ“¦é™¤çš„æœ€å°å•ä½æ˜¯Pageï¼ˆ256å­—èŠ‚ï¼‰               â”‚    â”‚
â”‚  â”‚  å³ä½¿åªæ”¹1ä¸ªå­—èŠ‚ï¼Œä¹Ÿå¿…é¡»ï¼š                            â”‚    â”‚
â”‚  â”‚    1. è¯»å‡ºæ•´ä¸ªPageåˆ°RAM                              â”‚    â”‚
â”‚  â”‚    2. åœ¨RAMä¸­ä¿®æ”¹é‚£1ä¸ªå­—èŠ‚                           â”‚    â”‚
â”‚  â”‚    3. æ“¦é™¤æ•´ä¸ªPage                                   â”‚    â”‚
â”‚  â”‚    4. å†™å›æ•´ä¸ªPage                                   â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  è¿™å°±æ˜¯å†™æ”¾å¤§ï¼                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  è¯•è¯•ä¸åŒå¤§å°çš„ä¿®æ”¹:                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ä¿®æ”¹å¤§å°: [1å­—èŠ‚â–¼] [æ‰§è¡Œ] â†’ å†™æ”¾å¤§: 256å€          â”‚    â”‚
â”‚  â”‚  ä¿®æ”¹å¤§å°: [32å­—èŠ‚â–¼] [æ‰§è¡Œ] â†’ å†™æ”¾å¤§: 8å€           â”‚    â”‚
â”‚  â”‚  ä¿®æ”¹å¤§å°: [128å­—èŠ‚â–¼] [æ‰§è¡Œ] â†’ å†™æ”¾å¤§: 2å€          â”‚    â”‚
â”‚  â”‚  ä¿®æ”¹å¤§å°: [256å­—èŠ‚â–¼] [æ‰§è¡Œ] â†’ å†™æ”¾å¤§: 1å€          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  [å¯è§†åŒ–åŠ¨ç”»] [å¯¹æ¯”å›¾]                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.3.3 åç«¯å®ç°

```python
@app.route('/write_amplification')
def write_amplification():
    """å†™æ”¾å¤§æ¼”ç¤ºé¡µé¢"""
    return render_template('write_amplification.html')

@app.route('/api/simulate_write', methods=['POST'])
def simulate_write():
    """æ¨¡æ‹Ÿå†™å…¥å¹¶è¿”å›å†™æ”¾å¤§æ•°æ®"""
    data = request.json
    page_id = data['page_id']
    offset = data['offset']
    write_size = data['size']

    page_size = 256

    result = {
        'user_intent': {
            'operation': 'write',
            'size_bytes': write_size,
            'description': f'ç”¨æˆ·æƒ³å†™å…¥ {write_size} å­—èŠ‚'
        },
        'eeprom_actual': {
            'operation': 'erase_and_write',
            'erase_size': page_size,
            'write_size': page_size,
            'description': f'EEPROMå®é™…æ“¦é™¤ {page_size} å­—èŠ‚ï¼Œå†™å…¥ {page_size} å­—èŠ‚'
        },
        'amplification': {
            'ratio': round(page_size / write_size, 1),
            'explanation': f'ä¸ºäº†ä¿®æ”¹ {write_size} å­—èŠ‚ï¼Œå®é™…æ“¦å†™äº† {page_size} å­—èŠ‚'
        },
        'steps': [
            f'1. è¯»å‡ºPage {page_id}çš„ {page_size} å­—èŠ‚åˆ°RAM',
            f'2. åœ¨RAMä¸­ä¿®æ”¹åç§»{offset}å¤„çš„{write_size}å­—èŠ‚',
            f'3. æ“¦é™¤Page {page_id}ï¼ˆ{page_size}å­—èŠ‚å…¨éƒ¨ç½®0xFFï¼‰',
            f'4. å†™å›Page {page_id}ï¼ˆ{page_size}å­—èŠ‚ï¼‰'
        ]
    }

    return jsonify(result)
```

---

### 3.4 æ¨¡å—4: ç£¨æŸå‡è¡¡æ¼”ç¤º

#### 3.4.1 å­¦ä¹ ç›®æ ‡

- çœ‹åˆ°ä¸å‡åŒ€å†™å…¥å¯¼è‡´çš„Pageå¯¿å‘½å·®å¼‚
- ç†è§£ç£¨æŸå‡è¡¡ç®—æ³•çš„å¿…è¦æ€§
- è¯„ä¼°ä¸åŒå‡è¡¡ç­–ç•¥çš„æ•ˆæœ

#### 3.4.2 ç•Œé¢è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç£¨æŸåˆ†æ                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  å½“å‰å„Pageç£¨æŸæƒ…å†µï¼ˆçƒ­åŠ›å›¾ï¼‰                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Page 0:  â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  1,234æ¬¡æ“¦å†™ (12%)     â”‚    â”‚
â”‚  â”‚  Page 1:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  4,567æ¬¡æ“¦å†™ (46%)     â”‚    â”‚
â”‚  â”‚  Page 2:  â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  567æ¬¡æ“¦å†™  (6%)       â”‚    â”‚
â”‚  â”‚  Page 3:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  8,901æ¬¡æ“¦å†™ (89%) âš ï¸  â”‚    â”‚
â”‚  â”‚  Page 4:  â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  123æ¬¡æ“¦å†™  (1%)       â”‚    â”‚
â”‚  â”‚  ...                                                  â”‚    â”‚
â”‚  â”‚                                                        â”‚    â”‚
â”‚  â”‚  å›¾ä¾‹:  â–ˆâ–ˆâ–ˆâ–ˆ é«˜ç£¨æŸ  â–‘â–‘â–‘â–‘ ä½ç£¨æŸ                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  ç£¨æŸç»Ÿè®¡                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  å¹³å‡æ“¦å†™æ¬¡æ•°: 2,345æ¬¡                               â”‚    â”‚
â”‚  â”‚  æœ€å¤§æ“¦å†™æ¬¡æ•°: 8,901æ¬¡ (Page 3)                     â”‚    â”‚
â”‚  â”‚  æœ€å°æ“¦å†™æ¬¡æ•°: 123æ¬¡ (Page 4)                       â”‚    â”‚
â”‚  â”‚  ä¸å‡åŒ€åº¦: 72å€ï¼ˆæœ€å·®Pageæ¯”æœ€å¥½Pageå¤šæ“¦å†™72å€ï¼‰     â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  âš ï¸ è­¦å‘Š: Page 3å³å°†è¾¾åˆ°å¯¿å‘½æé™ï¼ˆ89%ï¼‰            â”‚    â”‚
â”‚  â”‚  å»ºè®®: å¯ç”¨ç£¨æŸå‡è¡¡ç®—æ³•                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  å¯¹æ¯”å®éªŒ: ç£¨æŸå‡è¡¡ç®—æ³•                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ç­–ç•¥1: æ— ç£¨æŸå‡è¡¡ï¼ˆå½“å‰ï¼‰                           â”‚    â”‚
â”‚  â”‚    â†’ æŸäº›Pageä¼šå¿«é€Ÿå¤±æ•ˆï¼ŒèŠ¯ç‰‡æ•´ä½“å¯¿å‘½ç”±æœ€å·®Pageå†³å®š  â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  ç­–ç•¥2: ç®€å•è½®è¯¢å‡è¡¡                                 â”‚    â”‚
â”‚  â”‚    â†’ æ¯æ¬¡å†™å…¥é€‰æ‹©æ“¦å†™æ¬¡æ•°æœ€å°‘çš„Page                  â”‚    â”‚
â”‚  â”‚    â†’ [æ¨¡æ‹Ÿè¿è¡Œ1000æ¬¡å†™å…¥]                           â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  ç­–ç•¥3: åŠ¨æ€ç£¨æŸå‡è¡¡                                 â”‚    â”‚
â”‚  â”‚    â†’ åŠ¨æ€æ˜ å°„é€»è¾‘åœ°å€åˆ°ç‰©ç†åœ°å€                      â”‚    â”‚
â”‚  â”‚    â†’ è®°å½•æ¯ä¸ªPageçš„æ“¦å†™æ¬¡æ•°ï¼ŒåŠ¨æ€è°ƒæ•´               â”‚    â”‚
â”‚  â”‚    â†’ [æ¨¡æ‹Ÿè¿è¡Œ1000æ¬¡å†™å…¥]                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  [é‡ç½®ç»Ÿè®¡] [æ¨¡æ‹Ÿéšæœºå†™å…¥] [å¯¹æ¯”ä¸åŒç­–ç•¥]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.4.3 åç«¯å®ç°

```python
@app.route('/wear_leveling')
def wear_leveling():
    """ç£¨æŸå‡è¡¡æ¼”ç¤ºé¡µé¢"""
    pages_info = [chip.get_page_info(i) for i in range(chip.num_pages)]
    return render_template('wear_leveling.html', pages=pages_info)

@app.route('/api/wear_stats')
def wear_stats():
    """è·å–ç£¨æŸç»Ÿè®¡æ•°æ®"""
    erase_counts = [page.erase_count for page in chip.pages]

    stats = {
        'average': round(sum(erase_counts) / len(erase_counts), 1),
        'max': max(erase_counts),
        'min': min(erase_counts),
        'imbalance_ratio': round(max(erase_counts) / max(min(erase_counts), 1), 1),
        'pages': [
            {
                'id': i,
                'erase_count': page.erase_count,
                'life_percent': chip.get_page_info(i)['life_percent']
            }
            for i, page in enumerate(chip.pages)
        ]
    }
    return jsonify(stats)

@app.route('/api/simulate_writes', methods=['POST'])
def simulate_writes():
    """æ¨¡æ‹Ÿå¤šæ¬¡å†™å…¥ï¼Œè§‚å¯Ÿç£¨æŸå˜åŒ–"""
    data = request.json
    num_writes = data.get('num_writes', 100)
    strategy = data.get('strategy', 'none')  # none, round_robin, dynamic

    # è®°å½•åˆå§‹çŠ¶æ€
    initial_counts = [p.erase_count for p in chip.pages]

    # åˆ›å»ºä¸´æ—¶èŠ¯ç‰‡è¿›è¡Œæ¨¡æ‹Ÿ
    temp_chip = EEPROMChip(size_kb=4)

    for i in range(num_writes):
        if strategy == 'none':
            # æ€»æ˜¯å†™Page 0
            page_id = 0
        elif strategy == 'round_robin':
            # è½®è¯¢æ‰€æœ‰Page
            page_id = i % temp_chip.num_pages
        elif strategy == 'dynamic':
            # é€‰æ‹©æ“¦å†™æ¬¡æ•°æœ€å°‘çš„Page
            page_id = min(range(temp_chip.num_pages),
                          key=lambda pid: temp_chip.pages[pid].erase_count)

        # æ“¦é™¤å¹¶å†™å…¥
        temp_chip.erase_page(page_id)
        temp_chip.write(page_id * 256, b'\x12' * 10)

    final_counts = [p.erase_count for p in temp_chip.pages]

    return jsonify({
        'strategy': strategy,
        'num_writes': num_writes,
        'initial_counts': initial_counts,
        'final_counts': final_counts,
        'average': round(sum(final_counts) / len(final_counts), 1),
        'max': max(final_counts),
        'min': min(final_counts),
        'imbalance_ratio': round(max(final_counts) / max(min(final_counts), 1), 1),
    })
```

---

### 3.5 æ¨¡å—5: ä½ç¿»è½¬æ•…éšœæ¼”ç¤º

### 3.6 æ¨¡å—6: NvM Jobé˜Ÿåˆ—ä¸çŠ¶æ€æœºæ—¶é—´è½´

#### 3.6.1 å­¦ä¹ ç›®æ ‡
- è§‚å¯Ÿè¯·æ±‚å…¥é˜Ÿã€FIFOä¸ä¼˜å…ˆçº§/Immediateæ’é˜Ÿæ•ˆæœ
- è·Ÿè¸ªçŠ¶æ€æœºä»IDLEåˆ°BUSYå­çŠ¶æ€ï¼ˆREADING/WRITING/READ_VERIFY/WRITE_VERIFY/RECOVERING/COMPLETINGï¼‰
- ä½“éªŒè°ƒåº¦å»¶è¿Ÿ/æŠ–åŠ¨å¯¹é˜Ÿåˆ—å’Œè¶…æ—¶çš„å½±å“

#### 3.6.2 ç•Œé¢è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NvM Jobé˜Ÿåˆ—ä¸çŠ¶æ€æœºå¯è§†åŒ–                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  [æ—¶é—´æ§åˆ¶]                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  æ—¶é—´å€é€Ÿ: [1x] [10x] [100x] [FASTEST]                 â”‚     â”‚
â”‚  â”‚  è™šæ‹Ÿæ—¶é—´: 1245ms                                       â”‚     â”‚
â”‚  â”‚  [æš‚åœ] [å•æ­¥å‰è¿›] [è¿ç»­è¿è¡Œ] [é‡ç½®]                    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  [è°ƒåº¦èŠ‚æ‹è½¨é“]                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Eep_MainFunction (5ms):  |â–ˆ|   |â–ˆ|   |â–ˆ|   |â–ˆ|   |â–ˆ|    â”‚     â”‚
â”‚  â”‚  NvM_MainFunction (10ms): | â–ˆ   | â–ˆ   | â–ˆ   | â–ˆ        â”‚     â”‚
â”‚  â”‚  è™šæ‹Ÿæ—¶é—´è½´:              0   10   20   30   40   50   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  [Jobé˜Ÿåˆ—çŠ¶æ€]                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  é˜Ÿåˆ—é•¿åº¦: 3 | æœ€å¤§é•¿åº¦: 5 | è¶…æ—¶è®¡æ•°: 0                â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  é˜Ÿé¦– (æ­£åœ¨æ‰§è¡Œ):                                        â”‚     â”‚
â”‚  â”‚    [IDLEâ†’READING] Block0_ReadJob (prio=HIGH) t=1240    â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  ç­‰å¾…é˜Ÿåˆ—:                                               â”‚     â”‚
â”‚  â”‚    1. [WAITING] Block1_WriteJob (prio=MED) t=1242      â”‚     â”‚
â”‚  â”‚    2. [WAITING] Block2_WriteJob (prio=LOW, Immediate) t=1244â”‚
â”‚  â”‚    3. [WAITING] Block0_ReadAll (prio=HIGH) t=1245      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  [çŠ¶æ€æœºæ—¶é—´è½´]                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Block0: IDLEâ”€â†’READINGâ”€â†’READ_VERIFYâ”€â†’COMPLETINGâ”€â†’IDLE   â”‚     â”‚
â”‚  â”‚           1240    1245     1250        1255      1260   â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  Block1: IDLEâ”€â†’WRITINGâ”€â†’WRITE_VERIFY(é‡è¯•1)â”€â†’COMPLETINGâ”‚     â”‚
â”‚  â”‚           1260    1265     1270              1280      â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  Block2: (ç­‰å¾…ä¸­ï¼Œé¢„è®¡1260å¼€å§‹)                          â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  [æ·»åŠ æ–°Job]                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Jobç±»å‹: [Readâ–¼] [Write] [ReadAll] [WriteAll]          â”‚     â”‚
â”‚  â”‚  Block ID: [0â–¼] [1] [2] [3]                            â”‚     â”‚
â”‚  â”‚  ä¼˜å…ˆçº§: [LOWâ–¼] [MED] [HIGH]                            â”‚     â”‚
â”‚  â”‚  Immediate: â˜ (æ’é˜Ÿåˆ°é˜Ÿé¦–)                              â”‚     â”‚
â”‚  â”‚  [å…¥é˜Ÿ] [æ³¨å…¥å»¶è¿Ÿ(20ms)] [æ³¨å…¥è¶…æ—¶]                     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  [æ€§èƒ½æŒ‡æ ‡]                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  å¹³å‡é˜Ÿåˆ—é•¿åº¦: 2.3 | æœ€å¤§é˜Ÿåˆ—é•¿åº¦: 5                    â”‚     â”‚
â”‚  â”‚  è¶…æ—¶Jobæ•°: 0 | deadline_miss_count: 0                 â”‚     â”‚
â”‚  â”‚  æœ€å¤§æ‰§è¡Œæ—¶é—´: 45ms | å¹³å‡æ‰§è¡Œæ—¶é—´: 18ms                â”‚     â”‚
â”‚  â”‚  é‡è¯•æ¬¡æ•°: 2 | é‡è¯•æˆåŠŸç‡: 85%                          â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.6.3 åç«¯å®ç°ï¼ˆå®Œæ•´ä»£ç ï¼‰

```python
# tools/web_eeprom_viz/nvm_simulator.py

from enum import Enum
from dataclasses import dataclass, field
from typing import List, Optional, Callable
import time

class JobType(Enum):
    READ = "ReadBlock"
    WRITE = "WriteBlock"
    READ_ALL = "ReadAll"
    WRITE_ALL = "WriteAll"

class JobPriority(Enum):
    LOW = 0
    MED = 1
    HIGH = 2

class NvMState(Enum):
    IDLE = "IDLE"
    BUSY = "BUSY"
    READING = "READING"
    WRITING = "WRITING"
    READ_VERIFY = "READ_VERIFY"
    WRITE_VERIFY = "WRITE_VERIFY"
    RECOVERING = "RECOVERING"
    COMPLETING = "COMPLETING"

@dataclass
class Job:
    job_id: int
    job_type: JobType
    block_id: int
    priority: JobPriority = JobPriority.LOW
    immediate: bool = False
    enqueue_time: int = 0  # è™šæ‹Ÿæ—¶é—´(ms)
    start_time: int = 0
    deadline: Optional[int] = None
    state: NvMState = NvMState.IDLE
    retry_count: int = 0
    max_retries: int = 3

    def __lt__(self, other):
        """ä¼˜å…ˆçº§æ¯”è¾ƒï¼ˆç”¨äºé˜Ÿåˆ—æ’åºï¼‰"""
        # Immediateä»»åŠ¡ä¼˜å…ˆçº§æœ€é«˜
        if self.immediate and not other.immediate:
            return True
        if not self.immediate and other.immediate:
            return False
        # åŒImmediateçŠ¶æ€æŒ‰ä¼˜å…ˆçº§æ’åº
        if self.priority.value != other.priority.value:
            return self.priority.value > other.priority.value
        # åŒä¼˜å…ˆçº§æŒ‰å…¥é˜Ÿæ—¶é—´FIFO
        return self.enqueue_time < other.enqueue_time

@dataclass
class BlockContext:
    block_id: int
    state: NvMState = NvMState.IDLE
    current_job: Optional[Job] = None
    history: List[dict] = field(default_factory=list)

    def add_history(self, state: NvMState, timestamp: int):
        self.history.append({
            'state': state.value,
            'timestamp': timestamp
        })

class NvMSimulator:
    """NvMè½»é‡ä»¿çœŸå™¨ï¼šé˜Ÿåˆ—+çŠ¶æ€æœº+è™šæ‹Ÿè°ƒåº¦"""

    EEP_MAINFUNCTION_PERIOD = 5  # ms
    NVM_MAINFUNCTION_PERIOD = 10  # ms

    def __init__(self):
        self.virtual_time: int = 0  # è™šæ‹Ÿæ—¶é—´(ms)
        self.time_scale: float = 1.0  # æ—¶é—´å€é€Ÿ
        self.job_queue: List[Job] = []
        self.job_counter: int = 0
        self.blocks: dict[int, BlockContext] = {
            i: BlockContext(block_id=i) for i in range(4)
        }
        self.current_job: Optional[Job] = None
        self.metrics = {
            'max_queue_length': 0,
            'timeout_count': 0,
            'deadline_miss_count': 0,
            'max_exec_time': 0,
            'total_exec_time': 0,
            'completed_jobs': 0,
            'retry_count': 0,
            'retry_success': 0
        }

    def enqueue(self, job_type: JobType, block_id: int,
                priority: JobPriority = JobPriority.LOW,
                immediate: bool = False,
                deadline: Optional[int] = None) -> Job:
        """Jobå…¥é˜Ÿ"""
        job = Job(
            job_id=self.job_counter,
            job_type=job_type,
            block_id=block_id,
            priority=priority,
            immediate=immediate,
            enqueue_time=self.virtual_time,
            deadline=deadline,
            state=NvMState.IDLE
        )
        self.job_counter += 1

        # æ’é˜Ÿæˆ–æŒ‰ä¼˜å…ˆçº§æ’å…¥
        if immediate:
            self.job_queue.insert(0, job)
        else:
            self.job_queue.append(job)
            self.job_queue.sort()

        # æ›´æ–°æœ€å¤§é˜Ÿåˆ—é•¿åº¦
        if len(self.job_queue) > self.metrics['max_queue_length']:
            self.metrics['max_queue_length'] = len(self.job_queue)

        return job

    def dequeue(self) -> Optional[Job]:
        """Jobå‡ºé˜Ÿ"""
        if not self.job_queue:
            return None
        return self.job_queue.pop(0)

    def get_queue_snapshot(self) -> List[dict]:
        """è·å–é˜Ÿåˆ—å¿«ç…§"""
        return [
            {
                'job_id': job.job_id,
                'type': job.job_type.value,
                'block_id': job.block_id,
                'priority': job.priority.name,
                'immediate': job.immediate,
                'state': job.state.value,
                'enqueue_time': job.enqueue_time,
                'wait_time': self.virtual_time - job.enqueue_time
            }
            for job in self.job_queue
        ]

    def check_timeout(self, job: Job) -> bool:
        """æ£€æŸ¥Jobæ˜¯å¦è¶…æ—¶"""
        if job.deadline and self.virtual_time > job.deadline:
            self.metrics['deadline_miss_count'] += 1
            return True
        return False

    def execute_job(self, job: Job) -> bool:
        """æ‰§è¡Œå•ä¸ªJobï¼ˆç®€åŒ–ç‰ˆçŠ¶æ€æœºï¼‰"""
        block = self.blocks[job.block_id]

        # æ£€æŸ¥è¶…æ—¶
        if self.check_timeout(job):
            return False

        # ç®€åŒ–çŠ¶æ€æœºï¼šç›´æ¥æ‰§è¡Œå®Œæˆ
        if job.job_type == JobType.READ:
            job.state = NvMState.READING
            block.state = NvMState.READING
            block.add_history(NvMState.READING, self.virtual_time)

            # æ¨¡æ‹Ÿè¯»å–è€—æ—¶
            self.virtual_time += 5
            job.state = NvMState.READ_VERIFY
            block.add_history(NvMState.READ_VERIFY, self.virtual_time)

            self.virtual_time += 5
            job.state = NvMState.COMPLETING
            block.add_history(NvMState.COMPLETING, self.virtual_time)

        elif job.job_type == JobType.WRITE:
            job.state = NvMState.WRITING
            block.state = NvMState.WRITING
            block.add_history(NvMState.WRITING, self.virtual_time)

            # æ¨¡æ‹Ÿå†™å…¥è€—æ—¶
            self.virtual_time += 10

            # æ¨¡æ‹Ÿå¯èƒ½çš„æ ¡éªŒå¤±è´¥é‡è¯•
            if job.retry_count < job.max_retries and self.virtual_time % 17 == 0:
                job.retry_count += 1
                self.metrics['retry_count'] += 1
                job.state = NvMState.WRITE_VERIFY
                block.add_history(NvMState.WRITE_VERIFY, self.virtual_time)
                self.virtual_time += 5
                # é‡è¯•æˆåŠŸ
                self.metrics['retry_success'] += 1
            else:
                job.state = NvMState.WRITE_VERIFY
                block.add_history(NvMState.WRITE_VERIFY, self.virtual_time)
                self.virtual_time += 5

            job.state = NvMState.COMPLETING
            block.add_history(NvMState.COMPLETING, self.virtual_time)

        self.virtual_time += 5
        job.state = NvMState.IDLE
        block.state = NvMState.IDLE
        block.add_history(NvMState.IDLE, self.virtual_time)

        # æ›´æ–°æŒ‡æ ‡
        exec_time = self.virtual_time - job.start_time
        self.metrics['total_exec_time'] += exec_time
        if exec_time > self.metrics['max_exec_time']:
            self.metrics['max_exec_time'] = exec_time
        self.metrics['completed_jobs'] += 1

        return True

    def tick(self, ms: int = 10) -> dict:
        """æ¨è¿›è™šæ‹Ÿæ—¶é—´ï¼ˆå•ä½ï¼šmsï¼‰"""
        start_time = self.virtual_time

        # æ¨è¿›æ—¶é—´
        self.virtual_time += ms

        # è°ƒåº¦æ‰§è¡ŒJob
        if self.current_job is None and self.job_queue:
            self.current_job = self.dequeue()
            self.current_job.start_time = self.virtual_time

        if self.current_job:
            success = self.execute_job(self.current_job)
            if success:
                self.current_job = None

        # è¿”å›å¿«ç…§
        return {
            'virtual_time': self.virtual_time,
            'time_scale': self.time_scale,
            'queue_length': len(self.job_queue),
            'queue_snapshot': self.get_queue_snapshot(),
            'current_job': {
                'job_id': self.current_job.job_id,
                'type': self.current_job.job_type.value,
                'block_id': self.current_job.block_id,
                'state': self.current_job.state.value
            } if self.current_job else None,
            'blocks': {
                bid: {
                    'state': block.state.value,
                    'history': block.history[-5:] if block.history else []
                }
                for bid, block in self.blocks.items()
            },
            'metrics': self.get_metrics_summary()
        }

    def get_metrics_summary(self) -> dict:
        """è·å–æŒ‡æ ‡æ‘˜è¦"""
        avg_exec = (self.metrics['total_exec_time'] /
                   max(self.metrics['completed_jobs'], 1))
        return {
            'virtual_time': self.virtual_time,
            'queue_length': len(self.job_queue),
            'max_queue_length': self.metrics['max_queue_length'],
            'timeout_count': self.metrics['timeout_count'],
            'deadline_miss_count': self.metrics['deadline_miss_count'],
            'max_exec_time': self.metrics['max_exec_time'],
            'avg_exec_time': round(avg_exec, 1),
            'completed_jobs': self.metrics['completed_jobs'],
            'retry_count': self.metrics['retry_count'],
            'retry_success_rate': (
                self.metrics['retry_success'] /
                max(self.metrics['retry_count'], 1) * 100
                if self.metrics['retry_count'] > 0 else 100
            )
        }

    def set_time_scale(self, scale: float):
        """è®¾ç½®æ—¶é—´å€é€Ÿ"""
        self.time_scale = scale

    def reset(self):
        """é‡ç½®ä»¿çœŸå™¨"""
        self.virtual_time = 0
        self.job_queue.clear()
        self.job_counter = 0
        self.current_job = None
        self.metrics = {
            'max_queue_length': 0,
            'timeout_count': 0,
            'deadline_miss_count': 0,
            'max_exec_time': 0,
            'total_exec_time': 0,
            'completed_jobs': 0,
            'retry_count': 0,
            'retry_success': 0
        }
        for bid in self.blocks:
            self.blocks[bid] = BlockContext(block_id=bid)
```

#### 3.6.4 Flask APIå®ç°

```python
# åœ¨app.pyä¸­æ·»åŠ 

from nvm_simulator import NvMSimulator, JobType, JobPriority

nvm_sim = NvMSimulator()

@app.route('/nvm_queue')
def nvm_queue():
    """NvMé˜Ÿåˆ—ä¸çŠ¶æ€æœºé¡µé¢"""
    return render_template('nvm_queue.html')

@app.route('/api/nvm/enqueue', methods=['POST'])
def nvm_enqueue():
    """å…¥é˜Ÿæ–°Job"""
    data = request.json
    job_type = JobType[data['job_type'].upper()]
    priority = JobPriority[data['priority'].upper()]
    immediate = data.get('immediate', False)

    job = nvm_sim.enqueue(
        job_type=job_type,
        block_id=data['block_id'],
        priority=priority,
        immediate=immediate,
        deadline=data.get('deadline')
    )

    return jsonify({
        'success': True,
        'job_id': job.job_id,
        'queue_length': len(nvm_sim.job_queue)
    })

@app.route('/api/nvm/tick', methods=['POST'])
def nvm_tick():
    """æ¨è¿›è™šæ‹Ÿæ—¶é—´"""
    data = request.json
    ms = data.get('ms', 10)

    snapshot = nvm_sim.tick(ms)

    return jsonify(snapshot)

@app.route('/api/nvm/metrics')
def nvm_metrics():
    """è·å–æ€§èƒ½æŒ‡æ ‡"""
    return jsonify(nvm_sim.get_metrics_summary())

@app.route('/api/nvm/reset', methods=['POST'])
def nvm_reset():
    """é‡ç½®ä»¿çœŸå™¨"""
    nvm_sim.reset()
    return jsonify({'success': True})

@app.route('/api/nvm/time_scale', methods=['POST'])
def nvm_time_scale():
    """è®¾ç½®æ—¶é—´å€é€Ÿ"""
    data = request.json
    nvm_sim.set_time_scale(data['scale'])
    return jsonify({'success': True, 'scale': data['scale']})
```

### 3.7 æ¨¡å—7: WriteAllä¸€è‡´æ€§ä¸è„æ•°æ®æ£€æµ‹

#### 3.7.1 å­¦ä¹ ç›®æ ‡
- ç†è§£WriteAllä¸¤é˜¶æ®µæäº¤ï¼ˆPhase1å¿«ç…§+æ ¡éªŒï¼ŒPhase2æŒä¹…åŒ–ï¼‰
- ä½“éªŒRAM Mirroråœ¨å¤åˆ¶çª—å£è¢«ä¿®æ”¹è§¦å‘è„æ•°æ®æ£€æµ‹ä¸é‡è¯•
- æ‰ç”µ/ä¸­æ–­åï¼Œæ ¹æ®æŒä¹…åŒ–æ ‡å¿—æ¢å¤æˆ–å›æ»š

#### 3.7.2 ç•Œé¢è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WriteAllä¸¤é˜¶æ®µæäº¤ä¸ä¸€è‡´æ€§ä¿éšœ                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  [ä¸¤é˜¶æ®µæµç¨‹å¯è§†åŒ–]                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Phase1: å¿«ç…§ä¸æ ¡éªŒ                                     â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚     â”‚
â”‚  â”‚  â”‚ 1. åˆ›å»ºBlockå¿«ç…§ (RAM Mirror)               â”‚      â”‚     â”‚
â”‚  â”‚  â”‚    Block0(0x100) â†’ snapshot[0]             â”‚      â”‚     â”‚
â”‚  â”‚  â”‚    Block1(0x200) â†’ snapshot[1]             â”‚      â”‚     â”‚
â”‚  â”‚  â”‚    Block2(0x300) â†’ snapshot[2]             â”‚      â”‚     â”‚
â”‚  â”‚  â”‚                                              â”‚      â”‚     â”‚
â”‚  â”‚  â”‚ 2. è®¡ç®—ç»„checksum                            â”‚      â”‚     â”‚
â”‚  â”‚  â”‚    checksum = CRC16(snapshot[0] + [1] + [2])â”‚      â”‚     â”‚
â”‚  â”‚  â”‚    checksum = 0x4A3F                        â”‚      â”‚     â”‚
â”‚  â”‚  â”‚                                              â”‚      â”‚     â”‚
â”‚  â”‚  â”‚ 3. å†™å…¥æŒä¹…åŒ–æ ‡å¿—                            â”‚      â”‚     â”‚
â”‚  â”‚  â”‚    PHASE1_COMPLETE_FLAG = 1                â”‚      â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚     â”‚
â”‚  â”‚                              â†“                            â”‚     â”‚
â”‚  â”‚  âš ï¸ [è„æ•°æ®æ£€æµ‹ç‚¹] å¤åˆ¶æœŸé—´RAMæ˜¯å¦è¢«ä¿®æ”¹?               â”‚     â”‚
â”‚  â”‚     å¤åˆ¶åchecksum: 0x4A3F vs ç°åœ¨checksum: 0x7B2C     â”‚     â”‚
â”‚  â”‚     âœ— ä¸ä¸€è‡´! æ ‡è®°è„æ•°æ® â†’ é‡è¯•Phase1                  â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  Phase2: æŒä¹…åŒ–                                         â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚     â”‚
â”‚  â”‚  â”‚ 4. é¡ºåºå†™å…¥Blockåˆ°EEPROM                     â”‚      â”‚     â”‚
â”‚  â”‚  â”‚    EEPROM[0x100] = snapshot[0] âœ“            â”‚      â”‚     â”‚
â”‚  â”‚  â”‚    BLOCK_PERSISTENT_FLAG[0] = 1             â”‚      â”‚     â”‚
â”‚  â”‚  â”‚                                              â”‚      â”‚     â”‚
â”‚  â”‚  â”‚    EEPROM[0x200] = snapshot[1] âœ“            â”‚      â”‚     â”‚
â”‚  â”‚  â”‚    BLOCK_PERSISTENT_FLAG[1] = 1             â”‚      â”‚     â”‚
â”‚  â”‚  â”‚                                              â”‚      â”‚     â”‚
â”‚  â”‚  â”‚    EEPROM[0x300] = snapshot[2] ...          â”‚      â”‚     â”‚
â”‚  â”‚  â”‚                                              â”‚      â”‚     â”‚
â”‚  â”‚  â”‚ 5. æ¸…é™¤æ ‡å¿—ä½                                â”‚      â”‚     â”‚
â”‚  â”‚  â”‚    PHASE1_COMPLETE_FLAG = 0                 â”‚      â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  [äº¤äº’æ§ä»¶]                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  â˜‘ æ¨¡æ‹Ÿè„æ•°æ®: åœ¨Phase1å¤åˆ¶çª—å£ä¿®æ”¹RAM                 â”‚     â”‚
â”‚  â”‚     â†’ è§¦å‘checksumä¸åŒ¹é… â†’ Jobé‡è¯•                     â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  â˜‘ æ¨¡æ‹Ÿæ‰ç”µ: åœ¨Phase2éšæœºä½ç½®ä¸­æ–­                      â”‚     â”‚
â”‚  â”‚     â†’ é‡å¯åè¯»å–æ ‡å¿—ä½å†³å®šæ¢å¤ç­–ç•¥                     â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  [å¼€å§‹WriteAll] [å•æ­¥æ‰§è¡Œ] [é‡ç½®å®éªŒ]                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  [æ ‡å¿—ä½çŠ¶æ€]                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  PHASE1_COMPLETE_FLAG: 1 (å·²å®Œæˆå¿«ç…§)                 â”‚     â”‚
â”‚  â”‚  BLOCK_PERSISTENT_FLAG: [1, 1, 0] (Block2æœªæŒä¹…åŒ–)     â”‚     â”‚
â”‚  â”‚  replay_count: 0 (æ— é‡è¯•)                             â”‚     â”‚
â”‚  â”‚  dirty_detected: False                                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  [æ¢å¤ç­–ç•¥é€‰æ‹© - æ‰ç”µåæ˜¾ç¤º]                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  æ£€æµ‹åˆ°Phase1å·²å®Œæˆï¼ŒPhase2éƒ¨åˆ†å®Œæˆ                     â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  ç­–ç•¥1: ç»§ç»­Phase2 (æ¨è)                               â”‚     â”‚
â”‚  â”‚    â†’ ä»Block2ç»§ç»­å†™å…¥ï¼Œå®Œæˆåæ¸…é™¤æ ‡å¿—                   â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  ç­–ç•¥2: å›æ»šåˆ°Phase1                                    â”‚     â”‚
â”‚  â”‚    â†’ é‡æ–°å¿«ç…§å¹¶æ‰§è¡Œå®Œæ•´WriteAll                         â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  [é€‰æ‹©ç­–ç•¥1] [é€‰æ‹©ç­–ç•¥2]                                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.7.3 åç«¯å®ç°ï¼ˆæ‰©å±•nvm_simulator.pyï¼‰

```python
# tools/web_eeprom_viz/nvm_simulator.py (æ‰©å±•)

@dataclass
class WriteAllContext:
    """WriteAllä¸¤é˜¶æ®µæäº¤ä¸Šä¸‹æ–‡"""
    blocks: List[int]  # æ¶‰åŠçš„Block IDåˆ—è¡¨
    phase1_complete: bool = False
    phase1_checksum: int = 0
    snapshots: dict[int, bytes] = field(default_factory=dict)
    persistent_flags: dict[int, bool] = field(default_factory=dict)
    current_phase: int = 0  # 0=æœªå¼€å§‹, 1=Phase1, 2=Phase2
    dirty_detected: bool = False
    retry_count: int = 0

class WriteAllSimulator:
    """WriteAllä¸€è‡´æ€§ä»¿çœŸå™¨"""

    def __init__(self, nvm_sim: NvMSimulator, eeprom_chip: EEPROMChip):
        self.nvm_sim = nvm_sim
        self.eeprom = eeprom_chip
        self.writeall_ctx: Optional[WriteAllContext] = None
        self.phase1_complete_flag: bool = False  # æ¨¡æ‹ŸEEPROMæ ‡å¿—ä½
        self.block_persistent_flags: dict[int, bool] = {}  # æ¨¡æ‹ŸEEPROMæ ‡å¿—ä½

    def start_writeall(self, block_ids: List[int]) -> WriteAllContext:
        """å¼€å§‹WriteAllæµç¨‹"""
        self.writeall_ctx = WriteAllContext(blocks=block_ids)
        self.writeall_ctx.current_phase = 1

        # æ¨¡æ‹ŸPhase1å¿«ç…§
        for bid in block_ids:
            # ä»RAM Mirrorè¯»å–å¿«ç…§ï¼ˆç®€åŒ–ï¼šç”¨éšæœºæ•°æ®ï¼‰
            snapshot = bytes([bid * 16 + i for i in range(16)])
            self.writeall_ctx.snapshots[bid] = snapshot
            self.block_persistent_flags[bid] = False

        # è®¡ç®—ç»„checksum
        import crcmod
        crc16 = crcmod.predefined.mkCrcFun('crc-16')
        all_data = b''.join([self.writeall_ctx.snapshots[bid]
                            for bid in block_ids])
        self.writeall_ctx.phase1_checksum = crc16(all_data)

        self.writeall_ctx.phase1_complete = True
        self.phase1_complete_flag = True  # æŒä¹…åŒ–åˆ°EEPROM

        return self.writeall_ctx

    def check_dirty_data(self) -> bool:
        """æ£€æŸ¥è„æ•°æ®ï¼ˆå¤åˆ¶åRAMæ˜¯å¦è¢«ä¿®æ”¹ï¼‰"""
        if not self.writeall_ctx or not self.writeall_ctx.phase1_complete:
            return False

        # é‡æ–°è®¡ç®—checksum
        import crcmod
        crc16 = crcmod.predefined.mkCrcFun('crc-16')

        # æ¨¡æ‹Ÿï¼šå¦‚æœç”¨æˆ·å‹¾é€‰"æ¨¡æ‹Ÿè„æ•°æ®"ï¼Œè¿”å›ä¸ä¸€è‡´
        # è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…åº”ç”±å‰ç«¯å‚æ•°æ§åˆ¶
        return self.writeall_ctx.dirty_detected

    def phase2_persist(self, block_idx: int) -> bool:
        """Phase2: æŒä¹…åŒ–å•ä¸ªBlock"""
        if not self.writeall_ctx:
            return False

        if block_idx >= len(self.writeall_ctx.blocks):
            return False

        bid = self.writeall_ctx.blocks[block_idx]
        snapshot = self.writeall_ctx.snapshots[bid]

        # å†™å…¥EEPROMï¼ˆç®€åŒ–ï¼‰
        address = bid * 256
        self.eeprom.write(address, snapshot)

        # è®¾ç½®æŒä¹…åŒ–æ ‡å¿—
        self.block_persistent_flags[bid] = True

        # æ£€æŸ¥æ˜¯å¦å…¨éƒ¨å®Œæˆ
        all_done = all([self.block_persistent_flags[bid]
                       for bid in self.writeall_ctx.blocks])

        if all_done:
            # æ¸…é™¤Phase1æ ‡å¿—
            self.phase1_complete_flag = False
            self.writeall_ctx.current_phase = 0

        return True

    def inject_dirty_data(self):
        """æ³¨å…¥è„æ•°æ®ï¼ˆç”¨äºæ¼”ç¤ºï¼‰"""
        if self.writeall_ctx:
            self.writeall_ctx.dirty_detected = True

    def power_loss_recovery(self) -> dict:
        """æ‰ç”µæ¢å¤ï¼šæ ¹æ®æ ‡å¿—ä½å†³å®šç­–ç•¥"""
        if self.phase1_complete_flag:
            # Phase1å·²å®Œæˆï¼Œæ£€æŸ¥Phase2è¿›åº¦
            persisted = [bid for bid, flag in self.block_persistent_flags.items()
                       if flag]
            not_persisted = [bid for bid in self.writeall_ctx.blocks
                            if bid not in persisted]

            return {
                'status': 'phase2_partial',
                'phase1_complete': True,
                'persisted_blocks': persisted,
                'pending_blocks': not_persisted,
                'recommended_action': 'continue_phase2',
                'alternative_action': 'rollback_phase1'
            }
        else:
            # Phase1æœªå®Œæˆæˆ–å®Œå…¨å®Œæˆ
            return {
                'status': 'not_started_or_complete',
                'phase1_complete': False,
                'recommended_action': 'restart'
            }

    def reset(self):
        """é‡ç½®çŠ¶æ€"""
        self.writeall_ctx = None
        self.phase1_complete_flag = False
        self.block_persistent_flags.clear()

# åœ¨app.pyä¸­æ·»åŠ API
writeall_sim = WriteAllSimulator(nvm_sim, chip)

@app.route('/writeall_consistency')
def writeall_consistency():
    return render_template('writeall_consistency.html')

@app.route('/api/writeall/start', methods=['POST'])
def writeall_start():
    data = request.json
    block_ids = data['block_ids']

    ctx = writeall_sim.start_writeall(block_ids)

    return jsonify({
        'success': True,
        'phase': ctx.current_phase,
        'checksum': f'0x{ctx.phase1_checksum:04X}',
        'blocks': ctx.blocks
    })

@app.route('/api/writeall/phase2', methods=['POST'])
def writeall_phase2():
    data = request.json
    block_idx = data['block_idx']

    success = writeall_sim.phase2_persist(block_idx)

    return jsonify({
        'success': success,
        'persistent_flags': writeall_sim.block_persistent_flags,
        'phase1_complete': writeall_sim.phase1_complete_flag
    })

@app.route('/api/writeall/inject_dirty', methods=['POST'])
def writeall_inject_dirty():
    writeall_sim.inject_dirty_data()
    return jsonify({'success': True, 'dirty_detected': True})

@app.route('/api/writeall/recovery', methods=['GET'])
def writeall_recovery():
    recovery_info = writeall_sim.power_loss_recovery()
    return jsonify(recovery_info)
```

### 3.8 æ¨¡å—8: Blockç±»å‹ä¸æ¢å¤è·¯å¾„æ¼”ç¤º

#### 3.8.1 å­¦ä¹ ç›®æ ‡
- å¯¹æ¯”Native/Redundant/Datasetçš„å­˜å‚¨ç»“æ„ã€å†™å…¥ç­–ç•¥ã€æ¢å¤é€»è¾‘
- ä½“éªŒå†—ä½™åˆ‡æ¢ã€ç‰ˆæœ¬å›é€€ã€ç´¢å¼•è¶Šç•Œå¤„ç†

#### 3.8.2 ç•Œé¢è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Blockç±»å‹å¯¹æ¯”ä¸æ¢å¤è·¯å¾„æ¼”ç¤º                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  [ä¸‰å¡ç‰‡å¯¹æ¯”è§†å›¾]                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Native Block  â”‚  Redundant Blockâ”‚  Dataset Block â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚ ç»“æ„:          â”‚ ç»“æ„:          â”‚ ç»“æ„:          â”‚           â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚
â”‚  â”‚ â”‚Data (64B)  â”‚ â”‚ â”‚Primary   â”‚  â”‚ â”‚Version 0 â”‚  â”‚           â”‚
â”‚  â”‚ â”‚CRC16 (2B)  â”‚ â”‚ â”‚Data+CRC  â”‚  â”‚ â”‚Data+CRC  â”‚  â”‚           â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚Backup    â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚           â”‚
â”‚  â”‚                â”‚ â”‚Data+CRC  â”‚  â”‚ â”‚Version 1 â”‚  â”‚           â”‚
â”‚  â”‚ ç‰¹ç‚¹:          â”‚ â”‚Version#  â”‚  â”‚ â”‚Data+CRC  â”‚  â”‚           â”‚
â”‚  â”‚ â€¢ å•å‰¯æœ¬       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚           â”‚
â”‚  â”‚ â€¢ ROMå›é€€      â”‚ ç‰¹ç‚¹:          â”‚ â”‚Version 2 â”‚  â”‚           â”‚
â”‚  â”‚ â€¢ æœ€å°ç©ºé—´     â”‚ â€¢ ä¸»å¤‡å†—ä½™     â”‚ â”‚Data+CRC  â”‚  â”‚           â”‚
â”‚  â”‚                â”‚ â€¢ è‡ªåŠ¨åˆ‡æ¢     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚
â”‚  â”‚                â”‚ â€¢ ç‰ˆæœ¬å·       â”‚ ç‰¹ç‚¹:          â”‚           â”‚
â”‚  â”‚                â”‚                â”‚ â€¢ å¤šç‰ˆæœ¬       â”‚           â”‚
â”‚  â”‚                â”‚                â”‚ â€¢ ç¯å½¢ç¼“å†²     â”‚           â”‚
â”‚  â”‚                â”‚                â”‚ â€¢ å¯å›é€€       â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                   â”‚
â”‚  [äº¤äº’å¼å®éªŒ]                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  é€‰æ‹©Blockç±»å‹: [Nativeâ–¼]                              â”‚     â”‚
â”‚  â”‚  Blockå¤§å°: 64B                                        â”‚     â”‚
â”‚  â”‚  EEPROMåœ°å€: 0x1000                                    â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  [æ‰§è¡Œè¯»æ“ä½œ] [æ‰§è¡Œå†™æ“ä½œ] [æ³¨å…¥æ•…éšœ]                  â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  æ•…éšœç±»å‹: [CRCå¤±è´¥â–¼] [ä½ç¿»è½¬] [æ‰ç”µ] [ç‰ˆæœ¬è¶Šç•Œ]       â”‚     â”‚
â”‚  â”‚  [æ³¨å…¥æ•…éšœå¹¶è§‚å¯Ÿæ¢å¤]                                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  [å­˜å‚¨å¸ƒå±€å¯è§†åŒ–]                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  å½“å‰é€‰æ‹©: Redundant Block                              â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  EEPROMå¸ƒå±€:                                            â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚     â”‚
â”‚  â”‚  â”‚ 0x1000: Primary Copy                       â”‚       â”‚     â”‚
â”‚  â”‚  â”‚         Data: [12 34 56 78 ...]            â”‚       â”‚     â”‚
â”‚  â”‚  â”‚         CRC16: 0x4A3F âœ“ Valid             â”‚       â”‚     â”‚
â”‚  â”‚  â”‚         Version: 5                         â”‚       â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚     â”‚
â”‚  â”‚  â”‚ 0x1044: Backup Copy                        â”‚       â”‚     â”‚
â”‚  â”‚  â”‚         Data: [AA BB CC DD ...]            â”‚       â”‚     â”‚
â”‚  â”‚  â”‚         CRC16: 0x7B2C âœ— Invalid (ç‰ˆæœ¬æ—§)   â”‚       â”‚     â”‚
â”‚  â”‚  â”‚         Version: 4                         â”‚       â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  [æ¢å¤è·¯å¾„åŠ¨ç”»]                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  åœºæ™¯: Primary CRCå¤±è´¥                                 â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  æ­¥éª¤1: è¯»å–Primary Copy                                â”‚     â”‚
â”‚  â”‚         â†’ CRCæ ¡éªŒå¤±è´¥ âœ—                                 â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  æ­¥éª¤2: å°è¯•Backup Copy                                 â”‚     â”‚
â”‚  â”‚         â†’ CRCæ ¡éªŒé€šè¿‡ âœ“                                 â”‚     â”‚
â”‚  â”‚         â†’ ç‰ˆæœ¬å·æ£€æŸ¥: Version 4 (æœ‰æ•ˆ)                  â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  æ­¥éª¤3: ä½¿ç”¨Backupæ•°æ®                                   â”‚     â”‚
â”‚  â”‚         â†’ æ¢å¤åˆ°RAM: [AA BB CC DD ...]                  â”‚     â”‚
â”‚  â”‚         â†’ æ ‡è®°Primaryéœ€é‡å†™                             â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  ç»“æœ: âœ“ æˆåŠŸä»Backupæ¢å¤                               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  [Datasetç‰ˆæœ¬å›é€€æ¼”ç¤º]                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  å½“å‰ç‰ˆæœ¬: Version 2 (æœ€æ–°)                             â”‚     â”‚
â”‚  â”‚  ç‰ˆæœ¬å†å²:                                              â”‚     â”‚
â”‚  â”‚    Version 2: [æ–°æ•°æ®] CRC=0x8F1A âœ“ (å½“å‰)             â”‚     â”‚
â”‚  â”‚    Version 1: [æ—§æ•°æ®] CRC=0x4B2C âœ“ (æœ‰æ•ˆ)             â”‚     â”‚
â”‚  â”‚    Version 0: [åˆå§‹æ•°æ®] CRC=0x2C3D âœ“ (æœ‰æ•ˆ)           â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  [å›é€€åˆ°Version 1] [å›é€€åˆ°Version 0]                   â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  è¶Šç•Œæµ‹è¯•: DataIndex=3 (æœ€å¤§=2) â†’ âœ— é”™è¯¯æç¤º           â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.8.3 åç«¯å®ç°ï¼ˆæ‰©å±•nvm_simulator.pyï¼‰

```python
# tools/web_eeprom_viz/nvm_simulator.py (æ‰©å±•Blockç±»å‹)

from enum import Enum

class BlockType(Enum):
    NATIVE = "native"
    REDUNDANT = "redundant"
    DATASET = "dataset"

@dataclass
class NativeBlock:
    """Native Block: Data + CRC"""
    block_id: int
    data: bytearray
    crc16: int = 0
    rom_default: bytes = b'\x00' * 64

    def read(self) -> tuple[bool, bytes]:
        import crcmod
        crc16_func = crcmod.predefined.mkCrcFun('crc-16')
        calculated_crc = crc16_func(bytes(self.data))

        if calculated_crc == self.crc16:
            return True, bytes(self.data)
        else:
            # CRCå¤±è´¥ï¼Œè¿”å›ROMé»˜è®¤å€¼
            return False, self.rom_default

    def write(self, new_data: bytes):
        import crcmod
        crc16_func = crcmod.predefined.mkCrcFun('crc-16')
        self.data = bytearray(new_data)
        self.crc16 = crc16_func(new_data)

@dataclass
class RedundantBlock:
    """Redundant Block: Primary + Backup + Version"""
    block_id: int
    primary_data: bytearray
    primary_crc: int = 0
    backup_data: bytearray = field(default_factory=lambda: bytearray(64))
    backup_crc: int = 0
    primary_version: int = 0
    backup_version: int = 0

    def read(self) -> tuple[bool, str, bytes]:
        import crcmod
        crc16_func = crcmod.predefined.mkCrcFun('crc-16')

        # å°è¯•Primary
        primary_crc_ok = (crc16_func(bytes(self.primary_data)) ==
                         self.primary_crc)
        if primary_crc_ok:
            return True, 'primary', bytes(self.primary_data)

        # Primaryå¤±è´¥ï¼Œå°è¯•Backup
        backup_crc_ok = (crc16_func(bytes(self.backup_data)) ==
                        self.backup_crc)
        if backup_crc_ok:
            return True, 'backup', bytes(self.backup_data)

        # éƒ½å¤±è´¥ï¼Œè¿”å›ç©ºæ•°æ®
        return False, 'failed', b'\x00' * 64

    def write(self, new_data: bytes):
        import crcmod
        crc16_func = crcmod.predefined.mkCrcFun('crc-16')

        # æ–°æ•°æ®å†™å…¥Primaryï¼Œæ—§Primaryç§»åˆ°Backup
        self.backup_data = self.primary_data
        self.backup_crc = self.primary_crc
        self.backup_version = self.primary_version

        self.primary_data = bytearray(new_data)
        self.primary_crc = crc16_func(new_data)
        self.primary_version += 1

@dataclass
class DatasetBlock:
    """Dataset Block: å¤šç‰ˆæœ¬ç¯å½¢ç¼“å†²"""
    block_id: int
    max_versions: int = 3
    versions: list[bytearray] = field(default_factory=lambda:
                                      [bytearray(64) for _ in range(3)])
    crcs: list[int] = field(default_factory=lambda: [0] * 3)
    current_index: int = 0

    def read(self) -> tuple[bool, int, bytes]:
        import crcmod
        crc16_func = crcmod.predefined.mkCrcFun('crc-16')

        # è¯»å–å½“å‰ç‰ˆæœ¬
        data = self.versions[self.current_index]
        crc = self.crcs[self.current_index]
        calculated_crc = crc16_func(bytes(data))

        if calculated_crc == crc:
            return True, self.current_index, bytes(data)

        # å½“å‰ç‰ˆæœ¬å¤±è´¥ï¼Œå°è¯•å…¶ä»–ç‰ˆæœ¬
        for i in range(self.max_versions):
            if i == self.current_index:
                continue
            data = self.versions[i]
            crc = self.crcs[i]
            calculated_crc = crc16_func(bytes(data))
            if calculated_crc == crc:
                return True, i, bytes(data)

        return False, -1, b'\x00' * 64

    def write(self, new_data: bytes) -> bool:
        import crcmod
        crc16_func = crcmod.predefined.mkCrcFun('crc-16')

        # ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªç‰ˆæœ¬
        self.current_index = (self.current_index + 1) % self.max_versions

        # å†™å…¥æ–°ç‰ˆæœ¬
        self.versions[self.current_index] = bytearray(new_data)
        self.crcs[self.current_index] = crc16_func(new_data)

        return True

    def rollback(self, version_index: int) -> tuple[bool, str]:
        """å›é€€åˆ°æŒ‡å®šç‰ˆæœ¬"""
        if version_index < 0 or version_index >= self.max_versions:
            return False, f'ç‰ˆæœ¬ç´¢å¼•è¶Šç•Œ: {version_index} (æœ€å¤§{self.max_versions-1})'

        import crcmod
        crc16_func = crcmod.predefined.mkCrcFun('crc-16')
        data = self.versions[version_index]
        crc = self.crcs[version_index]

        if crc16_func(bytes(data)) == crc:
            self.current_index = version_index
            return True, f'æˆåŠŸå›é€€åˆ°Version {version_index}'
        else:
            return False, f'Version {version_index} CRCæ— æ•ˆ'

class BlockTypeSimulator:
    """Blockç±»å‹ä»¿çœŸå™¨"""

    def __init__(self, eeprom_chip: EEPROMChip):
        self.eeprom = eeprom_chip
        self.native_blocks: dict[int, NativeBlock] = {}
        self.redundant_blocks: dict[int, RedundantBlock] = {}
        self.dataset_blocks: dict[int, DatasetBlock] = {}

    def create_block(self, block_id: int, block_type: BlockType):
        """åˆ›å»ºæ–°Block"""
        if block_type == BlockType.NATIVE:
            self.native_blocks[block_id] = NativeBlock(
                block_id=block_id,
                data=bytearray([block_id * 16 + i for i in range(64)])
            )
        elif block_type == BlockType.REDUNDANT:
            self.redundant_blocks[block_id] = RedundantBlock(
                block_id=block_id,
                primary_data=bytearray([block_id * 16 + i for i in range(64)])
            )
        elif block_type == BlockType.DATASET:
            self.dataset_blocks[block_id] = DatasetBlock(
                block_id=block_id,
                versions=[bytearray([block_id * 16 + i + v * 10
                                   for i in range(64)])
                         for v in range(3)]
            )

    def read_block(self, block_id: int, block_type: BlockType) -> dict:
        """è¯»å–Blockï¼Œè¿”å›è¯¦ç»†ä¿¡æ¯"""
        if block_type == BlockType.NATIVE:
            block = self.native_blocks.get(block_id)
            if not block:
                return {'error': 'Block not found'}

            success, data = block.read()
            return {
                'type': 'native',
                'block_id': block_id,
                'success': success,
                'data': data.hex().upper(),
                'source': 'primary' if success else 'rom_default',
                'crc': f'0x{block.crc16:04X}'
            }

        elif block_type == BlockType.REDUNDANT:
            block = self.redundant_blocks.get(block_id)
            if not block:
                return {'error': 'Block not found'}

            success, source, data = block.read()
            return {
                'type': 'redundant',
                'block_id': block_id,
                'success': success,
                'data': data.hex().upper(),
                'source': source,
                'primary_version': block.primary_version,
                'backup_version': block.backup_version
            }

        elif block_type == BlockType.DATASET:
            block = self.dataset_blocks.get(block_id)
            if not block:
                return {'error': 'Block not found'}

            success, version_idx, data = block.read()
            return {
                'type': 'dataset',
                'block_id': block_id,
                'success': success,
                'data': data.hex().upper(),
                'current_version': version_idx if success else block.current_index,
                'max_versions': block.max_versions
            }

    def inject_crc_error(self, block_id: int, block_type: BlockType):
        """æ³¨å…¥CRCé”™è¯¯"""
        if block_type == BlockType.NATIVE and block_id in self.native_blocks:
            self.native_blocks[block_id].crc16 = 0xFFFF  # é”™è¯¯CRC
        elif block_type == BlockType.REDUNDANT and block_id in self.redundant_blocks:
            self.redundant_blocks[block_id].primary_crc = 0xFFFF
        elif block_type == BlockType.DATASET and block_id in self.dataset_blocks:
            self.dataset_blocks[block_id].crcs[
                self.dataset_blocks[block_id].current_index
            ] = 0xFFFF

# åœ¨app.pyä¸­æ·»åŠ API
block_type_sim = BlockTypeSimulator(chip)

@app.route('/block_types')
def block_types():
    return render_template('block_types.html')

@app.route('/api/block/create', methods=['POST'])
def block_create():
    data = request.json
    block_type = BlockType[data['block_type'].upper()]
    block_type_sim.create_block(data['block_id'], block_type)
    return jsonify({'success': True})

@app.route('/api/block/read', methods=['POST'])
def block_read():
    data = request.json
    block_type = BlockType[data['block_type'].upper()]
    result = block_type_sim.read_block(data['block_id'], block_type)
    return jsonify(result)

@app.route('/api/block/inject_error', methods=['POST'])
def block_inject_error():
    data = request.json
    block_type = BlockType[data['block_type'].upper()]
    block_type_sim.inject_crc_error(data['block_id'], block_type)
    return jsonify({'success': True, 'message': 'CRCé”™è¯¯å·²æ³¨å…¥'})
```

### 4.1 ç•Œé¢è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®éªŒ: ä½ç¿»è½¬æ•…éšœ                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  åœºæ™¯: æ¨¡æ‹ŸEEPROMå› å¹²æ‰°æˆ–è€åŒ–å¯¼è‡´çš„æ•°æ®ä½ç¿»è½¬                  â”‚
â”‚                                                               â”‚
â”‚  åŸå§‹æ•°æ®ï¼ˆå·²å†™å…¥EEPROMï¼‰:                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  åœ°å€    æ•°æ®        äºŒè¿›åˆ¶                          â”‚    â”‚
â”‚  â”‚  0x100:  0xAA     10101010                          â”‚    â”‚
â”‚  â”‚  0x101:  0x55     01010101                          â”‚    â”‚
â”‚  â”‚  0x102:  0xFF     11111111                          â”‚    â”‚
â”‚  â”‚  0x103:  0x00     00000000                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  [æ³¨å…¥ä½ç¿»è½¬æ•…éšœ]                                             â”‚
â”‚                         â†“                                    â”‚
â”‚  å‘ç”Ÿä½ç¿»è½¬å:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  åœ°å€    æ•°æ®        äºŒè¿›åˆ¶          å˜åŒ–            â”‚    â”‚
â”‚  â”‚  0x100:  0xAE     10101110        ç¬¬1ä½: 0â†’1 âš ï¸    â”‚    â”‚
â”‚  â”‚  0x101:  0x55     01010101        (æ— å˜åŒ–)          â”‚    â”‚
â”‚  â”‚  0x102:  0x7F     01111111        ç¬¬7ä½: 1â†’0 âš ï¸    â”‚    â”‚
â”‚  â”‚  0x103:  0x00     00000000        (æ— å˜åŒ–)          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  CRCæ ¡éªŒæ£€æµ‹:                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  åŸå§‹CRC16: 0x4A3F                                   â”‚    â”‚
â”‚  â”‚  ç¿»è½¬åCRC16: 0x7B2C                                 â”‚    â”‚
â”‚  â”‚  âœ“ CRCä¸åŒ¹é…ï¼æ•°æ®æŸåè¢«æ£€æµ‹åˆ°                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  [é‡ç½®å®éªŒ] [éšæœºç¿»è½¬å¤šæ¯”ç‰¹] [æ˜¾ç¤ºCRCè®¡ç®—è¿‡ç¨‹]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 åç«¯å®ç°

```python
import random

def inject_bit_flip(data: bytes, num_bits: int = 1) -> tuple[bytes, list]:
    """
    æ³¨å…¥ä½ç¿»è½¬æ•…éšœ

    è¿”å›: (ç¿»è½¬åæ•°æ®, ç¿»è½¬ä½ç½®åˆ—è¡¨)
    """
    data_array = bytearray(data)
    flip_positions = []

    for _ in range(num_bits):
        # éšæœºé€‰æ‹©å­—èŠ‚å’Œä½
        byte_idx = random.randint(0, len(data_array) - 1)
        bit_idx = random.randint(0, 7)

        # ç¿»è½¬è¯¥ä½
        original = data_array[byte_idx]
        data_array[byte_idx] ^= (1 << bit_idx)

        flip_positions.append({
            'offset': byte_idx,
            'bit': bit_idx,
            'original': f'0x{original:02X}',
            'flipped': f'0x{data_array[byte_idx]:02X}',
            'original_binary': f'{original:08b}',
            'flipped_binary': f'{data_array[byte_idx]:08b}',
        })

    return bytes(data_array), flip_positions

@app.route('/bit_flip')
def bit_flip():
    """ä½ç¿»è½¬æ¼”ç¤ºé¡µé¢"""
    return render_template('bit_flip.html')

@app.route('/api/inject_bit_flip', methods=['POST'])
def api_inject_bit_flip():
    """æ³¨å…¥ä½ç¿»è½¬"""
    data = request.json
    # è·å–å½“å‰EEPROMæ•°æ®
    address = data.get('address', 0)
    length = data.get('length', 4)
    original_data = chip.read(address, length)

    # æ³¨å…¥ä½ç¿»è½¬
    num_bits = data.get('num_bits', 1)
    flipped_data, flips = inject_bit_flip(original_data, num_bits)

    # è®¡ç®—CRC
    import crcmod
    crc16_func = crcmod.predefined.mkCrcFun('crc-16')

    return jsonify({
        'address': f'0x{address:04X}',
        'original_data': original_data.hex().upper(),
        'flipped_data': flipped_data.hex().upper(),
        'original_crc': f'0x{crc16_func(original_data):04X}',
        'flipped_crc': f'0x{crc16_func(flipped_data):04X}',
        'crc_mismatch': crc16_func(original_data) != crc16_func(flipped_data),
        'flip_positions': flips
    })
```

---

## 4. äº¤äº’å¼æ•™ç¨‹ç³»ç»Ÿï¼ˆåˆå­¦è€…å­¦ä¹ è·¯å¾„ï¼‰

### 4.1 è®¾è®¡ç†å¿µ

ä¸ºäº†å…¼é¡¾**è¯¾å ‚æ•™å­¦**å’Œ**è‡ªä¸»å­¦ä¹ **ï¼Œè®¾è®¡ç»“æ„åŒ–çš„å­¦ä¹ è·¯å¾„ç³»ç»Ÿï¼š

- **åˆ†å±‚æ¬¡å­¦ä¹ è·¯å¾„**ï¼šå¿«é€Ÿå…¥é—¨(30åˆ†é’Ÿ)ã€æ ‡å‡†è·¯å¾„(2å°æ—¶)ã€ä¸“å®¶æ¨¡å¼(4å°æ—¶)
- **æ£€æŸ¥ç‚¹æœºåˆ¶**ï¼šæ¯ä¸ªå…³é”®æ¦‚å¿µåè®¾ç½®äº¤äº’å¼æµ‹éªŒï¼Œé€šè¿‡åæ‰èƒ½ç»§ç»­
- **è¿›åº¦ä¿å­˜**ï¼šä½¿ç”¨æµè§ˆå™¨localStorageä¿å­˜å­¦ä¹ è¿›åº¦
- **å³æ—¶åé¦ˆ**ï¼šæ“ä½œåç«‹å³æ˜¾ç¤ºè§£é‡Šå’Œæ­£ç¡®ç­”æ¡ˆ
- **åœºæ™¯åŒ–ä»»åŠ¡**ï¼šåŸºäºçœŸå®å·¥ç¨‹åœºæ™¯è®¾è®¡ç»ƒä¹ 

### 4.2 å­¦ä¹ è·¯å¾„è§„åˆ’

```
å­¦ä¹ è·¯å¾„ç³»ç»Ÿ
â”œâ”€â”€ ğŸŸ¢ å¿«é€Ÿå…¥é—¨è·¯å¾„ï¼ˆ30åˆ†é’Ÿï¼‰
â”‚   â”œâ”€â”€ ç›®æ ‡ï¼šç†è§£EEPROMåŸºæœ¬æ¦‚å¿µ
â”‚   â”œâ”€â”€ æ¨¡å—1: EEPROMç‰©ç†ç»“æ„ï¼ˆ5åˆ†é’Ÿï¼‰
â”‚   â”‚   â”œâ”€â”€ è§‚çœ‹åŠ¨ç”»ï¼šPage/Blockå±‚æ¬¡ç»“æ„
â”‚   â”‚   â”œâ”€â”€ äº¤äº’ä»»åŠ¡ï¼šç‚¹å‡»PageæŸ¥çœ‹å†…å®¹
â”‚   â”‚   â””â”€â”€ æ£€æŸ¥ç‚¹ï¼šè¯†åˆ«Pageå¤§å°å’Œåœ°å€è®¡ç®—
â”‚   â”‚
â”‚   â”œâ”€â”€ æ¨¡å—2: æ“¦é™¤-å†™å…¥ä¾èµ–ï¼ˆ10åˆ†é’Ÿï¼‰
â”‚   â”‚   â”œâ”€â”€ æ¦‚å¿µè®²è§£ï¼šä¸ºä»€ä¹ˆå¿…é¡»å…ˆæ“¦é™¤
â”‚   â”‚   â”œâ”€â”€ äº¤äº’å®éªŒï¼šæœªæ“¦é™¤å†™å…¥å¤±è´¥ vs æ“¦é™¤åå†™å…¥æˆåŠŸ
â”‚   â”‚   â”œâ”€â”€ ä»»åŠ¡ï¼šåˆ¤æ–­å“ªäº›å†™å…¥ä¼šæˆåŠŸ
â”‚   â”‚   â””â”€â”€ æ£€æŸ¥ç‚¹ï¼šä½æ“ä½œåˆ¤æ–­é¢˜ï¼ˆ3é¢˜ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ æ¨¡å—3: å†™æ”¾å¤§ç°è±¡ï¼ˆ5åˆ†é’Ÿï¼‰
â”‚   â”‚   â”œâ”€â”€ å¯¹æ¯”å®éªŒï¼š1Bä¿®æ”¹ â†’ 256Bæ“¦å†™
â”‚   â”‚   â””â”€â”€ æ£€æŸ¥ç‚¹ï¼šè®¡ç®—å†™æ”¾å¤§å€æ•°
â”‚   â”‚
â”‚   â””â”€â”€ æ¨¡å—4: CRCä¸æ•…éšœæ£€æµ‹ï¼ˆ10åˆ†é’Ÿï¼‰
â”‚       â”œâ”€â”€ ä½ç¿»è½¬æ¼”ç¤º
â”‚       â””â”€â”€ æ£€æŸ¥ç‚¹ï¼šè¯†åˆ«CRCæ ¡éªŒå¤±è´¥
â”‚
â”œâ”€â”€ ğŸŸ¡ æ ‡å‡†å­¦ä¹ è·¯å¾„ï¼ˆ2å°æ—¶ï¼‰
â”‚   â”œâ”€â”€ åŒ…å«å¿«é€Ÿå…¥é—¨æ‰€æœ‰å†…å®¹
â”‚   â”œâ”€â”€ æ¨¡å—5: NvMé˜Ÿåˆ—ä¸ä¼˜å…ˆçº§ï¼ˆ20åˆ†é’Ÿï¼‰
â”‚   â”‚   â”œâ”€â”€ Jobå…¥é˜Ÿæ¼”ç¤º
â”‚   â”‚   â”œâ”€â”€ Immediateæ’é˜Ÿå®éªŒ
â”‚   â”‚   â”œâ”€â”€ ä»»åŠ¡ï¼šè®¾è®¡Jobä¼˜å…ˆçº§ç­–ç•¥
â”‚   â”‚   â””â”€â”€ æ£€æŸ¥ç‚¹ï¼šé˜Ÿåˆ—æ’åºé¢„æµ‹
â”‚   â”‚
â”‚   â”œâ”€â”€ æ¨¡å—6: çŠ¶æ€æœºè·Ÿè¸ªï¼ˆ30åˆ†é’Ÿï¼‰
â”‚   â”‚   â”œâ”€â”€ çŠ¶æ€è½¬æ¢åŠ¨ç”»
â”‚   â”‚   â”œâ”€â”€ æ—¶é—´è½´æ‹–æ‹½å®éªŒ
â”‚   â”‚   â”œâ”€â”€ ä»»åŠ¡ï¼šç»˜åˆ¶ç‰¹å®šJobçš„çŠ¶æ€è½¨è¿¹
â”‚   â”‚   â””â”€â”€ æ£€æŸ¥ç‚¹ï¼šçŠ¶æ€è½¬æ¢æ¡ä»¶åˆ¤æ–­
â”‚   â”‚
â”‚   â”œâ”€â”€ æ¨¡å—7: WriteAllä¸€è‡´æ€§ï¼ˆ20åˆ†é’Ÿï¼‰
â”‚   â”‚   â”œâ”€â”€ ä¸¤é˜¶æ®µæäº¤æµç¨‹å›¾è§£
â”‚   â”‚   â”œâ”€â”€ è„æ•°æ®æ£€æµ‹å®éªŒ
â”‚   â”‚   â””â”€â”€ æ£€æŸ¥ç‚¹ï¼šæ¢å¤ç­–ç•¥é€‰æ‹©
â”‚   â”‚
â”‚   â””â”€â”€ æ¨¡å—8: Blockç±»å‹å¯¹æ¯”ï¼ˆ30åˆ†é’Ÿï¼‰
â”‚       â”œâ”€â”€ Native/Redundant/Datasetç»“æ„å¯¹æ¯”
â”‚       â”œâ”€â”€ æ•…éšœæ³¨å…¥ä¸æ¢å¤å®éªŒ
â”‚       â””â”€â”€ æ£€æŸ¥ç‚¹ï¼šé€‰æ‹©åˆé€‚çš„Blockç±»å‹
â”‚
â””â”€â”€ ğŸ”´ ä¸“å®¶æ¨¡å¼ï¼ˆ4å°æ—¶ï¼‰
    â”œâ”€â”€ åŒ…å«æ ‡å‡†è·¯å¾„æ‰€æœ‰å†…å®¹
    â”œâ”€â”€ æ¨¡å—9: æ€§èƒ½è°ƒä¼˜å®è·µï¼ˆ1å°æ—¶ï¼‰
    â”‚   â”œâ”€â”€ è°ƒåº¦å»¶è¿Ÿå¯¹é˜Ÿåˆ—çš„å½±å“
    â”‚   â”œâ”€â”€ æ—¶é—´å€é€Ÿå¯¹æ¯”å®éªŒ
    â”‚   â”œâ”€â”€ ä»»åŠ¡ï¼šä¼˜åŒ–Jobæäº¤ç­–ç•¥
    â”‚   â””â”€â”€ æ£€æŸ¥ç‚¹ï¼šæ€§èƒ½ç“¶é¢ˆåˆ†æ
    â”‚
    â”œâ”€â”€ æ¨¡å—10: æ•…éšœè¯Šæ–­ç»¼åˆæ¡ˆä¾‹ï¼ˆ1å°æ—¶ï¼‰
    â”‚   â”œâ”€â”€ åœºæ™¯1: é«˜è´Ÿè½½ä¸‹çš„è¶…æ—¶é—®é¢˜
    â”‚   â”œâ”€â”€ åœºæ™¯2: æ‰ç”µæ¢å¤å¤±è´¥
    â”‚   â”œâ”€â”€ åœºæ™¯3: ç£¨æŸä¸å‡
    â”‚   â””â”€â”€ ä»»åŠ¡ï¼šè¯Šæ–­å¹¶è§£å†³æ•…éšœ
    â”‚
    â””â”€â”€ æ¨¡å—11: è‡ªå®šä¹‰å®éªŒï¼ˆ2å°æ—¶ï¼‰
        â”œâ”€â”€ è‡ªç”±å®éªŒæ¨¡å¼
        â”œâ”€â”€ å‚æ•°é…ç½®ä¸å¯¹æ¯”
        â””â”€â”€ å®éªŒæŠ¥å‘Šç”Ÿæˆ
```

### 4.3 æ•™ç¨‹é¡µé¢è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“š äº¤äº’å¼æ•™ç¨‹ - å¿«é€Ÿå…¥é—¨è·¯å¾„                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  [è¿›åº¦æ¡] â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 40% (æ¨¡å—2/8)                    â”‚
â”‚                                                                   â”‚
â”‚  å½“å‰æ¨¡å—: æ¨¡å—2 - æ“¦é™¤-å†™å…¥ä¾èµ–å…³ç³»                              â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ğŸ“– æ¦‚å¿µè®²è§£ï¼ˆ3åˆ†é’Ÿï¼‰                                   â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  EEPROMçš„ç‰©ç†ç‰¹æ€§å†³å®šäº†å†™å…¥å‰å¿…é¡»å…ˆæ“¦é™¤ã€‚ä¸ºä»€ä¹ˆï¼Ÿ        â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  1. å­˜å‚¨å•å…ƒç»“æ„ï¼šæ¯ä¸ªä½æ˜¯ä¸€ä¸ª"æµ®åŠ¨æ …ç”µå­é˜±"             â”‚     â”‚
â”‚  â”‚  2. æ“¦é™¤æ“ä½œï¼šåŠ é«˜å‹æ³¨å…¥ç”µå­ â†’ æ‰€æœ‰ä½å˜1 (0xFF)          â”‚     â”‚
â”‚  â”‚  3. å†™å…¥æ“ä½œï¼šéš§ç©¿æ•ˆåº”æ‹‰å‡ºç”µå­ â†’ 1å¯ä»¥å˜0                â”‚     â”‚
â”‚  â”‚  4. å…³é”®é™åˆ¶ï¼š0æ— æ³•å˜1ï¼ˆé™¤éé‡æ–°æ“¦é™¤ï¼‰                   â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  [è§‚çœ‹åŠ¨ç”»æ¼”ç¤º 60ç§’]                                      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ğŸ§ª äº¤äº’å®éªŒï¼ˆ5åˆ†é’Ÿï¼‰                                   â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  ä»»åŠ¡1: å°è¯•æœªæ“¦é™¤ç›´æ¥å†™å…¥                               â”‚     â”‚
â”‚  â”‚  [å¼€å§‹å®éªŒ] â†’ è§‚å¯Ÿèƒ½å¦å†™å…¥ 0x55 åˆ°å·²æœ‰æ•°æ®çš„Page        â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  âŒ ç»“æœï¼šå†™å…¥å¤±è´¥                                      â”‚     â”‚
â”‚  â”‚  åŸå› ï¼šåŸæ•°æ® 0xAA (10101010)                           â”‚     â”‚
â”‚  â”‚       ç›®æ ‡æ•°æ® 0x55 (01010101)                          â”‚     â”‚
â”‚  â”‚       ç¬¬1,3,5,7ä½éœ€è¦0â†’1ï¼Œå¿…é¡»å…ˆæ“¦é™¤                    â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  ä»»åŠ¡2: å…ˆæ“¦é™¤å†å†™å…¥                                    â”‚     â”‚
â”‚  â”‚  [æ“¦é™¤Page] â†’ [å†™å…¥æ•°æ®] â†’ è§‚å¯Ÿç»“æœ                     â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  âœ… ç»“æœï¼šå†™å…¥æˆåŠŸ                                      â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  [é‡ç½®å®éªŒ] [è‡ªå·±å°è¯•]                                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  âœï¸ ç»ƒä¹ ä¸æ£€æŸ¥ç‚¹ï¼ˆå¿…é¡»é€šè¿‡æ‰èƒ½ç»§ç»­ï¼‰                    â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  é—®é¢˜1: ä»¥ä¸‹å“ªä¸ªå†™å…¥æ“ä½œå¯ä»¥æˆåŠŸï¼ˆæ— éœ€æ“¦é™¤ï¼‰ï¼Ÿ          â”‚     â”‚
â”‚  â”‚  âšª A. 0xFF â†’ 0x00                                      â”‚     â”‚
â”‚  â”‚  âšª B. 0xAA â†’ 0x55                                      â”‚     â”‚
â”‚  â”‚  âšª C. 0xF0 â†’ 0x00                                      â”‚     â”‚
â”‚  â”‚  âšª D. 0x00 â†’ 0xFF                                      â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  [æäº¤ç­”æ¡ˆ]                                              â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  âœ… æ­£ç¡®ï¼ç­”æ¡ˆæ˜¯Cã€‚0xF0 (11110000) â†’ 0x00 (00000000)   â”‚     â”‚
â”‚  â”‚     æ‰€æœ‰ä½éƒ½æ˜¯1â†’0ï¼Œå¯ä»¥ç›´æ¥å†™å…¥ã€‚                       â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  [ä¸‹ä¸€é¢˜] [è·³è¿‡æ£€æŸ¥ç‚¹ï¼ˆä¸“å®¶æ¨¡å¼ï¼‰]                       â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  [â† ä¸Šä¸€æ¨¡å—] [ä¿å­˜è¿›åº¦] [ä¸‹ä¸€æ¨¡å— â†’]                            â”‚
â”‚                                                                   â”‚
â”‚  [ğŸ  è¿”å›æ•™ç¨‹é¦–é¡µ] [ğŸ”§ åˆ‡æ¢åˆ°è°ƒè¯•æ¨¡å¼]                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 æ•™ç¨‹åç«¯å®ç°

```python
# tools/web_eeprom_viz/tutorial_manager.py

from dataclasses import dataclass
from typing import List, Dict, Optional
import json

@dataclass
class TutorialModule:
    module_id: int
    title: str
    duration_minutes: int
    concepts: List[str]
    tasks: List[dict]
    checkpoint: dict

class TutorialManager:
    """æ•™ç¨‹ç®¡ç†ç³»ç»Ÿ"""

    def __init__(self):
        self.modules = self._load_modules()
        self.user_progress = {}  # user_id -> {module_id: completed}

    def _load_modules(self) -> dict:
        """åŠ è½½æ•™ç¨‹æ¨¡å—é…ç½®"""
        return {
            'quick_start': [
                TutorialModule(
                    module_id=1,
                    title='EEPROMç‰©ç†ç»“æ„',
                    duration_minutes=5,
                    concepts=['Page', 'Block', 'åœ°å€å¯¹é½'],
                    tasks=[
                        {'type': 'observe', 'desc': 'è§‚å¯ŸPageå¸ƒå±€'},
                        {'type': 'interact', 'desc': 'ç‚¹å‡»PageæŸ¥çœ‹è¯¦æƒ…'}
                    ],
                    checkpoint={
                        'question': 'ä¸€ä¸ªPageçš„å¤§å°æ˜¯å¤šå°‘å­—èŠ‚ï¼Ÿ',
                        'options': ['128', '256', '512', '1024'],
                        'correct': 1
                    }
                ),
                TutorialModule(
                    module_id=2,
                    title='æ“¦é™¤-å†™å…¥ä¾èµ–',
                    duration_minutes=10,
                    concepts=['æ“¦é™¤', 'å†™å…¥', 'ä½æ“ä½œ'],
                    tasks=[
                        {'type': 'experiment', 'desc': 'æœªæ“¦é™¤å†™å…¥å®éªŒ'},
                        {'type': 'experiment', 'desc': 'æ“¦é™¤åå†™å…¥å®éªŒ'}
                    ],
                    checkpoint={
                        'question': 'åŸå€¼0xAAï¼Œå†™å…¥0x55æ˜¯å¦éœ€è¦æ“¦é™¤ï¼Ÿ',
                        'options': ['éœ€è¦', 'ä¸éœ€è¦'],
                        'correct': 0
                    }
                ),
                # ... æ›´å¤šæ¨¡å—
            ],
            'standard': [
                # æ ‡å‡†è·¯å¾„æ¨¡å—ï¼ˆåŒ…å«å¿«é€Ÿå…¥é—¨+è¿›é˜¶å†…å®¹ï¼‰
            ],
            'expert': [
                # ä¸“å®¶æ¨¡å¼æ¨¡å—
            ]
        }

    def get_module(self, path: str, module_id: int) -> Optional[TutorialModule]:
        """è·å–æŒ‡å®šæ¨¡å—"""
        modules = self.modules.get(path, [])
        for module in modules:
            if module.module_id == module_id:
                return module
        return None

    def check_answer(self, module_id: int, answer: int) -> dict:
        """æ£€æŸ¥æ£€æŸ¥ç‚¹ç­”æ¡ˆ"""
        # ç®€åŒ–ï¼šå®é™…åº”ä»æ¨¡å—é…ç½®ä¸­è¯»å–
        correct_answers = {
            1: 1,  # Pageå¤§å°256
            2: 0,  # 0xAAâ†’0x55éœ€è¦æ“¦é™¤
        }
        is_correct = (answer == correct_answers.get(module_id))
        return {
            'correct': is_correct,
            'explanation': self._get_explanation(module_id, is_correct)
        }

    def _get_explanation(self, module_id: int, is_correct: bool) -> str:
        """è·å–ç­”æ¡ˆè§£é‡Š"""
        if module_id == 1:
            return "æ­£ç¡®ï¼æ ‡å‡†EEPROM Pageå¤§å°ä¸º256å­—èŠ‚ã€‚"
        elif module_id == 2:
            return "æ­£ç¡®ï¼0xAA(10101010)â†’0x55(01010101)éœ€è¦0â†’1ï¼Œå¿…é¡»å…ˆæ“¦é™¤ã€‚"
        return ""

    def save_progress(self, user_id: str, module_id: int):
        """ä¿å­˜å­¦ä¹ è¿›åº¦"""
        if user_id not in self.user_progress:
            self.user_progress[user_id] = {}
        self.user_progress[user_id][module_id] = True

    def get_progress(self, user_id: str) -> dict:
        """è·å–å­¦ä¹ è¿›åº¦"""
        return self.user_progress.get(user_id, {})

# åœ¨app.pyä¸­æ·»åŠ API
tutorial_mgr = TutorialManager()

@app.route('/tutorial')
def tutorial_index():
    """æ•™ç¨‹é¦–é¡µ"""
    return render_template('tutorial/index.html')

@app.route('/tutorial/<path:learning_path>/<int:module_id>')
def tutorial_module(learning_path, module_id):
    """æ•™ç¨‹æ¨¡å—é¡µé¢"""
    module = tutorial_mgr.get_module(learning_path, module_id)
    if not module:
        return redirect('/tutorial')
    return render_template('tutorial/module.html',
                         module=module, path=learning_path)

@app.route('/api/tutorial/check', methods=['POST'])
def tutorial_check():
    """æ£€æŸ¥æ£€æŸ¥ç‚¹ç­”æ¡ˆ"""
    data = request.json
    result = tutorial_mgr.check_answer(data['module_id'], data['answer'])
    if result['correct']:
        # ä¿å­˜è¿›åº¦ï¼ˆç®€åŒ–ï¼šä½¿ç”¨sessionä½œä¸ºuser_idï¼‰
        user_id = session.get('user_id', 'anonymous')
        tutorial_mgr.save_progress(user_id, data['module_id'])
    return jsonify(result)

@app.route('/api/tutorial/progress')
def tutorial_progress():
    """è·å–å­¦ä¹ è¿›åº¦"""
    user_id = session.get('user_id', 'anonymous')
    progress = tutorial_mgr.get_progress(user_id)
    return jsonify(progress)
```

### 4.5 æ•™ç¨‹å‰ç«¯æ¨¡æ¿ç¤ºä¾‹

```html
<!-- templates/tutorial/module.html -->
{% extends "base.html" %}

{% block title %}{{ module.title }} - æ•™ç¨‹{% endblock %}

{% block content %}
<div class="container tutorial-container">
    <div class="progress mb-4">
        <div class="progress-bar" role="progressbar"
             style="width: {{ (module.module_id / 8 * 100) }}%"
             aria-valuenow="{{ module.module_id }}"
             aria-valuemin="0" aria-valuemax="8">
            æ¨¡å— {{ module.module_id }}/8
        </div>
    </div>

    <h2>ğŸ“– {{ module.title }}</h2>
    <p class="text-muted">é¢„è®¡æ—¶é—´: {{ module.duration_minutes }} åˆ†é’Ÿ</p>

    <!-- æ¦‚å¿µè®²è§£ -->
    <div class="card mb-4">
        <div class="card-header">
            <h4>ğŸ“š æ¦‚å¿µè®²è§£</h4>
        </div>
        <div class="card-body">
            <ul>
                {% for concept in module.concepts %}
                <li>{{ concept }}</li>
                {% endfor %}
            </ul>
            <button class="btn btn-primary" onclick="showConceptVideo()">
                ğŸ¬ è§‚çœ‹åŠ¨ç”»æ¼”ç¤º
            </button>
        </div>
    </div>

    <!-- äº¤äº’ä»»åŠ¡ -->
    <div class="card mb-4">
        <div class="card-header">
            <h4>ğŸ§ª äº¤äº’ä»»åŠ¡</h4>
        </div>
        <div class="card-body">
            {% for task in module.tasks %}
            <div class="task-item mb-3">
                <h5>{{ task.desc }}</h5>
                <button class="btn btn-outline-primary btn-sm">
                    å¼€å§‹ä»»åŠ¡
                </button>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- æ£€æŸ¥ç‚¹ -->
    <div class="card mb-4">
        <div class="card-header bg-warning">
            <h4>âœï¸ æ£€æŸ¥ç‚¹ - å¿…é¡»é€šè¿‡æ‰èƒ½ç»§ç»­</h4>
        </div>
        <div class="card-body">
            <p class="lead">{{ module.checkpoint.question }}</p>
            <div class="list-group" id="checkpointOptions">
                {% for i, option in enumerate(module.checkpoint.options) %}
                <button class="list-group-item list-group-item-action"
                        onclick="selectAnswer({{ i }})">
                    {{ ['A', 'B', 'C', 'D'][i] }}. {{ option }}
                </button>
                {% endfor %}
            </div>
            <button id="submitCheckpoint" class="btn btn-success mt-3"
                    onclick="submitAnswer()" disabled>
                æäº¤ç­”æ¡ˆ
            </button>
            <div id="checkpointResult" class="mt-3" style="display:none"></div>
        </div>
    </div>

    <!-- å¯¼èˆªæŒ‰é’® -->
    <div class="d-flex justify-content-between">
        <a href="/tutorial/{{ path }}/{{ module.module_id - 1 }}"
           class="btn btn-secondary {% if module.module_id == 1 %}disabled{% endif %}">
            â† ä¸Šä¸€æ¨¡å—
        </a>
        <a id="nextModuleBtn" href="/tutorial/{{ path }}/{{ module.module_id + 1 }}"
           class="btn btn-primary" style="display:none">
            ä¸‹ä¸€æ¨¡å— â†’
        </a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let selectedAnswer = null;

function selectAnswer(index) {
    selectedAnswer = index;
    document.querySelectorAll('#checkpointOptions button').forEach((btn, i) => {
        btn.classList.toggle('active', i === index);
    });
    document.getElementById('submitCheckpoint').disabled = false;
}

async function submitAnswer() {
    const response = await fetch('/api/tutorial/check', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            module_id: {{ module.module_id }},
            answer: selectedAnswer
        })
    });

    const result = await response.json();
    const resultDiv = document.getElementById('checkpointResult');
    resultDiv.style.display = 'block';

    if (result.correct) {
        resultDiv.innerHTML = `
            <div class="alert alert-success">
                <strong>âœ… æ­£ç¡®ï¼</strong><br>
                ${result.explanation}
            </div>
        `;
        document.getElementById('nextModuleBtn').style.display = 'inline-block';
    } else {
        resultDiv.innerHTML = `
            <div class="alert alert-danger">
                <strong>âŒ ä¸å¤ªå¯¹ï¼Œå†è¯•ä¸€æ¬¡ï¼</strong><br>
                ${result.explanation}
            </div>
        `;
    }
}

function showConceptVideo() {
    // æ˜¾ç¤ºæ¦‚å¿µåŠ¨ç”»ï¼ˆå¯ä»¥æ˜¯è§†é¢‘æˆ–CanvasåŠ¨ç”»ï¼‰
    alert('è¿™é‡Œå°†æ˜¾ç¤ºæ¦‚å¿µè®²è§£åŠ¨ç”»');
}
</script>
{% endblock %}
```

---

## 5. è°ƒè¯•å·¥ç¨‹å¸ˆæ¨¡å¼ï¼ˆé¡¹ç›®å¼€å‘ä¸è¯Šæ–­ï¼‰

### 5.1 è®¾è®¡ç›®æ ‡

ä¸º**å·¥ç¨‹å¸ˆè°ƒè¯•**å’Œ**é¡¹ç›®å¼€å‘**åœºæ™¯æä¾›ä¸“ä¸šå·¥å…·ï¼š

- **å®æ—¶æ€§èƒ½ç›‘æ§**ï¼šé˜Ÿåˆ—é•¿åº¦ã€å“åº”æ—¶é—´ã€èµ„æºåˆ©ç”¨ç‡
- **æ•…éšœæ³¨å…¥ç³»ç»Ÿ**ï¼šå¯æ§åœ°æ³¨å…¥å„ç§æ•…éšœåœºæ™¯
- **è¯Šæ–­åŠ©æ‰‹**ï¼šè‡ªåŠ¨åˆ†æå¼‚å¸¸å¹¶ç»™å‡ºå»ºè®®
- **æ—¥å¿—æŸ¥çœ‹å™¨**ï¼šç»“æ„åŒ–æ˜¾ç¤ºNvMè¿è¡Œæ—¥å¿—
- **å¿«ç…§ä¸å›æ”¾**ï¼šä¿å­˜ä»¿çœŸçŠ¶æ€å¹¶å›æ”¾é—®é¢˜åœºæ™¯
- **æ€§èƒ½åˆ†æ**ï¼šçƒ­ç‚¹è¯†åˆ«ã€ç“¶é¢ˆåˆ†æ

### 5.2 è°ƒè¯•æ§åˆ¶å°è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”§ è°ƒè¯•å·¥ç¨‹å¸ˆæ¨¡å¼ - NvMæ€§èƒ½è¯Šæ–­æ§åˆ¶å°                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  [å®æ—¶ç›‘æ§é¢æ¿] - è‡ªåŠ¨åˆ·æ–°ï¼ˆ1ç§’ï¼‰                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ğŸ“Š ç³»ç»ŸçŠ¶æ€                                            â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚     â”‚
â”‚  â”‚  â”‚ è™šæ‹Ÿæ—¶é—´ â”‚ é˜Ÿåˆ—é•¿åº¦ â”‚ æ‰§è¡Œä¸­   â”‚ å®Œæˆæ•°   â”‚         â”‚     â”‚
â”‚  â”‚  â”‚ 1245ms   â”‚ 3        â”‚ Block0   â”‚ 127      â”‚         â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡                                            â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚     â”‚
â”‚  â”‚  â”‚ é˜Ÿåˆ—é•¿åº¦è¶‹åŠ¿                             â”‚             â”‚     â”‚
â”‚  â”‚  â”‚ [å®æ—¶æŠ˜çº¿å›¾ - Chart.js]                â”‚             â”‚     â”‚
â”‚  â”‚  â”‚                                         â”‚             â”‚     â”‚
â”‚  â”‚  â”‚  5â”‚ â•­â”€â•®                                â”‚             â”‚     â”‚
â”‚  â”‚  â”‚  4â”‚ â”‚ â•­â•¯â•®                               â”‚             â”‚     â”‚
â”‚  â”‚  â”‚  3â”‚ â•­â•¯â•¯ â”‚                               â”‚             â”‚     â”‚
â”‚  â”‚  â”‚  2â”‚â•­â•¯â”˜  â”‚                               â”‚             â”‚     â”‚
â”‚  â”‚  â”‚  1â”‚â•¯    â”‚                               â”‚             â”‚     â”‚
â”‚  â”‚  â”‚  0â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€            â”‚             â”‚     â”‚
â”‚  â”‚  â”‚    0s   5s   10s   15s   20s           â”‚             â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  âš ï¸ å¼‚å¸¸æ£€æµ‹                                            â”‚     â”‚
â”‚  â”‚  â€¢ [12:34:56] é˜Ÿåˆ—é•¿åº¦è¶…è¿‡é˜ˆå€¼(>5)                       â”‚     â”‚
â”‚  â”‚  â€¢ [12:35:02] Jobæ‰§è¡Œæ—¶é—´è¿‡é•¿(45ms > 30ms)              â”‚     â”‚
â”‚  â”‚  â€¢ [12:35:10] Block2é‡è¯•æ¬¡æ•°è¿‡å¤š(3æ¬¡)                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  [æ•…éšœæ³¨å…¥é¢æ¿]                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  æ•…éšœç±»å‹: [é€‰æ‹©â–¼]                                      â”‚     â”‚
â”‚  â”‚    â€¢ è°ƒåº¦å»¶è¿Ÿ (0-100ms)                                 â”‚     â”‚
â”‚  â”‚    â€¢ CRCæ ¡éªŒå¤±è´¥                                        â”‚     â”‚
â”‚  â”‚    â€¢ ä½ç¿»è½¬ (å•bit/å¤šbit)                               â”‚     â”‚
â”‚  â”‚    â€¢ æ‰ç”µä¸­æ–­                                           â”‚     â”‚
â”‚  â”‚    â€¢ EEPROMå†™å…¥å¤±è´¥                                     â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  å‚æ•°é…ç½®:                                               â”‚     â”‚
â”‚  â”‚  å»¶è¿Ÿ: [====â—===] 50ms                                 â”‚     â”‚
â”‚  â”‚  æ¦‚ç‡: [â–ˆâ–ˆâ—====] 30%                                   â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  [æ³¨å…¥æ•…éšœ] [æ¸…é™¤æ‰€æœ‰æ•…éšœ] [ä¿å­˜åœºæ™¯]                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  [è¯Šæ–­åŠ©æ‰‹]                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ğŸ” æ™ºèƒ½è¯Šæ–­                                            â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  é—®é¢˜: é˜Ÿåˆ—æŒç»­å †ç§¯ï¼ŒJobå¹³å‡ç­‰å¾…æ—¶é—´ > 100ms            â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  å¯èƒ½åŸå› :                                              â”‚     â”‚
â”‚  â”‚  1. Jobæäº¤é€Ÿç‡è¿‡é«˜ (>10ä¸ª/ç§’)                          â”‚     â”‚
â”‚  â”‚  2. EEPROMå†™å…¥é€Ÿåº¦æ…¢ (å•æ¬¡20ms)                         â”‚     â”‚
â”‚  â”‚  3. è°ƒåº¦æŠ–åŠ¨è¿‡å¤§ (å¹³å‡15ms)                             â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  ğŸ’¡ å»ºè®®ä¼˜åŒ–:                                           â”‚     â”‚
â”‚  â”‚  â€¢ é™ä½éå…³é”®Jobçš„ä¼˜å…ˆçº§                                 â”‚     â”‚
â”‚  â”‚  â€¢ å¯ç”¨Jobåˆå¹¶ï¼ˆå¤šä¸ªå°Jobåˆå¹¶ä¸ºä¸€ä¸ªå¤§Jobï¼‰              â”‚     â”‚
â”‚  â”‚  â€¢ å‡å°‘è°ƒåº¦å»¶è¿Ÿï¼ˆæ£€æŸ¥Eep_MainFunctionå‘¨æœŸï¼‰             â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  [åº”ç”¨å»ºè®®] [æŸ¥çœ‹è¯¦æƒ…] [å¿½ç•¥æ­¤é—®é¢˜]                     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  [æ—¥å¿—æŸ¥çœ‹å™¨]                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  [DEBUG] [12:34:56.789] NvM_JobEnqueue: Job#5 READ Block0â”‚     â”‚
â”‚  â”‚  [INFO ] [12:34:56.795] NvM_StateChange: Block0 IDLEâ†’READINGâ”‚     â”‚
â”‚  â”‚  [DEBUG] [12:34:57.123] Eep_Read: Page#12 addr=0x300 len=256â”‚     â”‚
â”‚  â”‚  [WARN ] [12:34:57.234] NvM_Retry: Block0 READ_VERIFY failedâ”‚     â”‚
â”‚  â”‚  [ERROR] [12:34:57.456] NvM_CrcError: Block0 checksum mismatchâ”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  çº§åˆ«: [Allâ–¼] [DEBUG] [INFO] [WARN] [ERROR]            â”‚     â”‚
â”‚  â”‚  æœç´¢: [_________] [è¿‡æ»¤] [å¯¼å‡ºæ—¥å¿—]                    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  [å¿«ç…§ä¸å›æ”¾]                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  å½“å‰å¿«ç…§: snapshot_20250103_123456.json                â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  [ğŸ’¾ ä¿å­˜å¿«ç…§] [ğŸ“‚ åŠ è½½å¿«ç…§] [â–¶ï¸ å›æ”¾] [â¸ï¸ æš‚åœ]        â”‚     â”‚
â”‚  â”‚                                                          â”‚     â”‚
â”‚  â”‚  å¿«ç…§å†å²:                                              â”‚     â”‚
â”‚  â”‚  â€¢ snapshot_20250103_123456.json (é˜Ÿåˆ—å †ç§¯åœºæ™¯)         â”‚     â”‚
â”‚  â”‚  â€¢ snapshot_20250103_115000.json (æ‰ç”µæ¢å¤åœºæ™¯)         â”‚     â”‚
â”‚  â”‚  â€¢ snapshot_20250103_103000.json (CRCå¤±è´¥åœºæ™¯)          â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â”‚  [ğŸ  è¿”å›ä¸»é¡µ] [ğŸ“š åˆ‡æ¢åˆ°æ•™ç¨‹æ¨¡å¼]                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 è°ƒè¯•æ¨¡å¼åç«¯å®ç°

```python
# tools/web_eeprom_viz/debug_manager.py

from dataclasses import dataclass, field
from typing import List, Dict, Optional
import json
import time
from datetime import datetime

@dataclass
class LogEntry:
    timestamp: float
    level: str  # DEBUG, INFO, WARN, ERROR
    module: str
    message: str
    details: dict = field(default_factory=dict)

@dataclass
class DiagnosticIssue:
    issue_id: str
    severity: str  # warning, error, critical
    title: str
    description: str
    possible_causes: List[str]
    recommendations: List[str]
    timestamp: float

class DebugManager:
    """è°ƒè¯•æ¨¡å¼ç®¡ç†å™¨"""

    def __init__(self, nvm_sim: NvMSimulator):
        self.nvm_sim = nvm_sim
        self.logs: List[LogEntry] = []
        self.issues: List[DiagnosticIssue] = []
        self.metrics_history: List[dict] = []
        self.snapshots: dict = {}
        self.fault_injections: dict = {}

    def log(self, level: str, module: str, message: str, details: dict = None):
        """è®°å½•æ—¥å¿—"""
        entry = LogEntry(
            timestamp=time.time(),
            level=level,
            module=module,
            message=message,
            details=details or {}
        )
        self.logs.append(entry)
        # ä¿æŒæ—¥å¿—æ•°é‡åœ¨åˆç†èŒƒå›´
        if len(self.logs) > 10000:
            self.logs = self.logs[-5000:]

    def get_logs(self, level_filter: str = None,
                 module_filter: str = None,
                 limit: int = 1000) -> List[dict]:
        """è·å–æ—¥å¿—"""
        filtered = self.logs

        if level_filter:
            filtered = [l for l in filtered if l.level == level_filter]
        if module_filter:
            filtered = [l for l in filtered if l.module == module_filter]

        return [
            {
                'timestamp': datetime.fromtimestamp(l.timestamp).strftime('%H:%M:%S.%f')[:-3],
                'level': l.level,
                'module': l.module,
                'message': l.message,
                'details': l.details
            }
            for l in filtered[-limit:]
        ]

    def collect_metrics(self) -> dict:
        """æ”¶é›†å½“å‰æŒ‡æ ‡"""
        metrics = self.nvm_sim.get_metrics_summary()
        metrics['timestamp'] = time.time()
        self.metrics_history.append(metrics)

        # ä¿æŒå†å²è®°å½•åœ¨åˆç†èŒƒå›´
        if len(self.metrics_history) > 1000:
            self.metrics_history = self.metrics_history[-500:]

        return metrics

    def analyze_performance(self) -> List[DiagnosticIssue]:
        """æ€§èƒ½åˆ†æï¼Œç”Ÿæˆè¯Šæ–­å»ºè®®"""
        issues = []
        metrics = self.nvm_sim.get_metrics_summary()

        # æ£€æŸ¥é˜Ÿåˆ—å †ç§¯
        if metrics['queue_length'] > 5:
            issues.append(DiagnosticIssue(
                issue_id=f'queue_backlog_{int(time.time())}',
                severity='warning',
                title='é˜Ÿåˆ—æŒç»­å †ç§¯',
                description=f'å½“å‰é˜Ÿåˆ—é•¿åº¦ {metrics["queue_length"]}ï¼Œå¯èƒ½å½±å“å®æ—¶æ€§',
                possible_causes=[
                    'Jobæäº¤é€Ÿç‡è¿‡é«˜',
                    'Jobæ‰§è¡Œæ—¶é—´è¿‡é•¿',
                    'è°ƒåº¦å»¶è¿Ÿè¿‡å¤§'
                ],
                recommendations=[
                    'é™ä½éå…³é”®Jobä¼˜å…ˆçº§',
                    'å¯ç”¨Jobåˆå¹¶',
                    'æ£€æŸ¥è°ƒåº¦å‘¨æœŸé…ç½®'
                ],
                timestamp=time.time()
            ))

        # æ£€æŸ¥è¶…æ—¶
        if metrics['deadline_miss_count'] > 0:
            issues.append(DiagnosticIssue(
                issue_id=f'timeout_{int(time.time())}',
                severity='error',
                title=f'{metrics["deadline_miss_count"]} ä¸ªJobè¶…æ—¶',
                description='æ£€æµ‹åˆ°Jobæ‰§è¡Œè¶…æ—¶',
                possible_causes=[
                    'å•ä¸ªJobæ‰§è¡Œæ—¶é—´è¿‡é•¿',
                    'è°ƒåº¦æŠ–åŠ¨',
                    'ç¡¬ä»¶å“åº”æ…¢'
                ],
                recommendations=[
                    'ä¼˜åŒ–Jobæ‰§è¡Œé€»è¾‘',
                    'å¢åŠ è¶…æ—¶é˜ˆå€¼',
                    'æ£€æŸ¥ç¡¬ä»¶çŠ¶æ€'
                ],
                timestamp=time.time()
            ))

        # æ£€æŸ¥é‡è¯•ç‡
        if metrics['retry_success_rate'] < 80:
            issues.append(DiagnosticIssue(
                issue_id=f'high_retry_{int(time.time())}',
                severity='warning',
                title=f'é‡è¯•æˆåŠŸç‡ä½ ({metrics["retry_success_rate"]:.1f}%)',
                description='æ£€æµ‹åˆ°å¤§é‡é‡è¯•å¤±è´¥',
                possible_causes=[
                    'EEPROMå†™å…¥ä¸ç¨³å®š',
                    'CRCè®¡ç®—é”™è¯¯',
                    'å¤–éƒ¨å¹²æ‰°'
                ],
                recommendations=[
                    'æ£€æŸ¥EEPROMè´¨é‡',
                    'éªŒè¯CRCå®ç°',
                    'å¢åŠ é”™è¯¯å¤„ç†'
                ],
                timestamp=time.time()
            ))

        self.issues.extend(issues)
        return issues

    def inject_fault(self, fault_type: str, params: dict) -> bool:
        """æ³¨å…¥æ•…éšœ"""
        fault_id = f'{fault_type}_{int(time.time())}'
        self.fault_injections[fault_id] = {
            'type': fault_type,
            'params': params,
            'active': True
        }

        self.log('WARN', 'FaultInjector',
                f'æ³¨å…¥æ•…éšœ: {fault_type}',
                params)

        return True

    def save_snapshot(self, name: str) -> str:
        """ä¿å­˜å½“å‰å¿«ç…§"""
        snapshot = {
            'name': name,
            'timestamp': time.time(),
            'nvm_state': {
                'virtual_time': self.nvm_sim.virtual_time,
                'job_queue': [job.__dict__ for job in self.nvm_sim.job_queue],
                'metrics': self.nvm_sim.get_metrics_summary()
            },
            'logs': self.get_logs(limit=1000),
            'issues': [issue.__dict__ for issue in self.issues[-100:]]
        }

        self.snapshots[name] = snapshot
        filename = f'{name}.json'

        self.log('INFO', 'Snapshot',
                f'ä¿å­˜å¿«ç…§: {filename}',
                {'virtual_time': snapshot['nvm_state']['virtual_time']})

        return filename

    def load_snapshot(self, name: str) -> bool:
        """åŠ è½½å¿«ç…§ï¼ˆç®€åŒ–ï¼šä¸å®é™…æ¢å¤çŠ¶æ€ï¼‰"""
        if name in self.snapshots:
            snapshot = self.snapshots[name]
            self.log('INFO', 'Snapshot',
                    f'åŠ è½½å¿«ç…§: {name}',
                    snapshot)
            return True
        return False

    def get_metrics_history(self, duration_seconds: int = 60) -> List[dict]:
        """è·å–æŒ‡æ ‡å†å²ï¼ˆç”¨äºå›¾è¡¨ï¼‰"""
        cutoff = time.time() - duration_seconds
        return [m for m in self.metrics_history if m['timestamp'] > cutoff]

# åœ¨app.pyä¸­æ·»åŠ API
debug_mgr = DebugManager(nvm_sim)

@app.route('/debug')
def debug_console():
    """è°ƒè¯•æ§åˆ¶å°"""
    return render_template('debug/console.html')

@app.route('/api/debug/metrics')
def debug_metrics():
    """è·å–å®æ—¶æŒ‡æ ‡"""
    return jsonify(debug_mgr.collect_metrics())

@app.route('/api/debug/metrics_history')
def debug_metrics_history():
    """è·å–æŒ‡æ ‡å†å²"""
    duration = request.args.get('duration', 60, type=int)
    return jsonify(debug_mgr.get_metrics_history(duration))

@app.route('/api/debug/logs')
def debug_logs():
    """è·å–æ—¥å¿—"""
    level = request.args.get('level')
    module = request.args.get('module')
    limit = request.args.get('limit', 1000, type=int)
    return jsonify(debug_mgr.get_logs(level, module, limit))

@app.route('/api/debug/diagnose')
def debug_diagnose():
    """æ‰§è¡Œè¯Šæ–­åˆ†æ"""
    issues = debug_mgr.analyze_performance()
    return jsonify({
        'issues': [issue.__dict__ for issue in issues],
        'metrics': debug_mgr.collect_metrics()
    })

@app.route('/api/debug/inject_fault', methods=['POST'])
def debug_inject_fault():
    """æ³¨å…¥æ•…éšœ"""
    data = request.json
    success = debug_mgr.inject_fault(data['fault_type'], data.get('params', {}))
    return jsonify({'success': success})

@app.route('/api/debug/snapshot', methods=['POST'])
def debug_snapshot():
    """ä¿å­˜å¿«ç…§"""
    data = request.json
    name = data.get('name', f'snapshot_{datetime.now().strftime("%Y%m%d_%H%M%S")}')
    filename = debug_mgr.save_snapshot(name)
    return jsonify({'success': True, 'filename': filename})
```

### 5.4 è°ƒè¯•æ§åˆ¶å°å‰ç«¯æ¨¡æ¿ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰

```html
<!-- templates/debug/console.html -->
{% extends "base.html" %}

{% block title %}è°ƒè¯•æ§åˆ¶å°{% endblock %}

{% block content %}
<div class="container-fluid debug-console">
    <div class="row">
        <!-- å·¦ä¾§ï¼šå®æ—¶ç›‘æ§ -->
        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header d-flex justify-content-between">
                    <span>ğŸ“Š å®æ—¶ç›‘æ§</span>
                    <span class="badge bg-success">â— Live</span>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-3">
                            <h4 id="virtTime">0ms</h4>
                            <small>è™šæ‹Ÿæ—¶é—´</small>
                        </div>
                        <div class="col-3">
                            <h4 id="queueLen">0</h4>
                            <small>é˜Ÿåˆ—é•¿åº¦</small>
                        </div>
                        <div class="col-3">
                            <h4 id="completed">0</h4>
                            <small>å·²å®Œæˆ</small>
                        </div>
                        <div class="col-3">
                            <h4 id="avgExec">0ms</h4>
                            <small>å¹³å‡æ‰§è¡Œ</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mb-3">
                <div class="card-header">ğŸ“ˆ é˜Ÿåˆ—é•¿åº¦è¶‹åŠ¿</div>
                <div class="card-body">
                    <canvas id="queueChart"></canvas>
                </div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šè¯Šæ–­åŠ©æ‰‹ -->
        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header">ğŸ” æ™ºèƒ½è¯Šæ–­</div>
                <div class="card-body" id="diagnosticResults">
                    <p class="text-muted">ç‚¹å‡»"å¼€å§‹è¯Šæ–­"åˆ†æç³»ç»ŸçŠ¶æ€...</p>
                </div>
                <div class="card-footer">
                    <button class="btn btn-primary" onclick="runDiagnosis()">
                        å¼€å§‹è¯Šæ–­
                    </button>
                </div>
            </div>

            <div class="card mb-3">
                <div class="card-header">âš ï¸ æ•…éšœæ³¨å…¥</div>
                <div class="card-body">
                    <select id="faultType" class="form-select mb-2">
                        <option value="delay">è°ƒåº¦å»¶è¿Ÿ</option>
                        <option value="crc_error">CRCæ ¡éªŒå¤±è´¥</option>
                        <option value="bit_flip">ä½ç¿»è½¬</option>
                        <option value="power_loss">æ‰ç”µä¸­æ–­</option>
                    </select>
                    <input type="range" class="form-range" id="faultParam"
                           min="0" max="100" value="50">
                    <button class="btn btn-danger w-100" onclick="injectFault()">
                        æ³¨å…¥æ•…éšœ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ—¥å¿—æŸ¥çœ‹å™¨ -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between">
                    <span>ğŸ“‹ æ—¥å¿—æŸ¥çœ‹å™¨</span>
                    <div>
                        <select id="logLevel" class="form-select form-select-sm">
                            <option value="">All</option>
                            <option value="DEBUG">DEBUG</option>
                            <option value="INFO">INFO</option>
                            <option value="WARN">WARN</option>
                            <option value="ERROR">ERROR</option>
                        </select>
                    </div>
                </div>
                <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                    <pre id="logViewer" class="mb-0"></pre>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
let queueChart;
let metricsInterval;

// åˆå§‹åŒ–å›¾è¡¨
function initChart() {
    const ctx = document.getElementById('queueChart').getContext('2d');
    queueChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'é˜Ÿåˆ—é•¿åº¦',
                data: [],
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true }
            },
            animation: { duration: 0 }
        }
    });
}

// æ›´æ–°å®æ—¶æŒ‡æ ‡
async function updateMetrics() {
    const response = await fetch('/api/debug/metrics');
    const metrics = await response.json();

    document.getElementById('virtTime').textContent = metrics.virtual_time + 'ms';
    document.getElementById('queueLen').textContent = metrics.queue_length;
    document.getElementById('completed').textContent = metrics.completed_jobs;
    document.getElementById('avgExec').textContent = metrics.avg_exec_time + 'ms';

    // æ›´æ–°å›¾è¡¨
    queueChart.data.labels.push(new Date().toLocaleTimeString());
    queueChart.data.datasets[0].data.push(metrics.queue_length);
    if (queueChart.data.labels.length > 20) {
        queueChart.data.labels.shift();
        queueChart.data.datasets[0].data.shift();
    }
    queueChart.update();
}

// è¯Šæ–­åˆ†æ
async function runDiagnosis() {
    const response = await fetch('/api/debug/diagnose');
    const result = await response.json();

    const resultsDiv = document.getElementById('diagnosticResults');
    if (result.issues.length === 0) {
        resultsDiv.innerHTML = `
            <div class="alert alert-success">
                <strong>âœ“ ç³»ç»Ÿè¿è¡Œæ­£å¸¸</strong><br>
                æœªæ£€æµ‹åˆ°å¼‚å¸¸é—®é¢˜ã€‚
            </div>
        `;
    } else {
        resultsDiv.innerHTML = result.issues.map(issue => `
            <div class="alert alert-${issue.severity === 'error' ? 'danger' : 'warning'}">
                <strong>${issue.severity === 'error' ? 'âŒ' : 'âš ï¸'} ${issue.title}</strong><br>
                ${issue.description}<br>
                <strong>å¯èƒ½åŸå› :</strong>
                <ul>${issue.possible_causes.map(c => `<li>${c}</li>`).join('')}</ul>
                <strong>å»ºè®®:</strong>
                <ul>${issue.recommendations.map(r => `<li>${r}</li>`).join('')}</ul>
            </div>
        `).join('');
    }
}

// æ³¨å…¥æ•…éšœ
async function injectFault() {
    const faultType = document.getElementById('faultType').value;
    const param = document.getElementById('faultParam').value;

    const response = await fetch('/api/debug/inject_fault', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({fault_type: faultType, params: {value: param}})
    });

    const result = await response.json();
    if (result.success) {
        alert(`å·²æ³¨å…¥æ•…éšœ: ${faultType}`);
    }
}

// åŠ è½½æ—¥å¿—
async function loadLogs() {
    const level = document.getElementById('logLevel').value;
    const url = `/api/debug/logs${level ? '?level=' + level : ''}`;

    const response = await fetch(url);
    const logs = await response.json();

    document.getElementById('logViewer').innerHTML = logs.map(log =>
        `[${log.timestamp}] [${log.level}] [${log.module}] ${log.message}`
    ).join('\n');
}

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    initChart();
    updateMetrics();
    loadLogs();

    // å®šæœŸæ›´æ–°
    metricsInterval = setInterval(updateMetrics, 1000);

    document.getElementById('logLevel').addEventListener('change', loadLogs);
});
</script>
{% endblock %}
```

---

## 6. å‰ç«¯å®ç°ï¼ˆæç®€æ–¹æ¡ˆï¼‰

### 5.1 æŠ€æœ¯é€‰æ‹©

- **HTMLæ¨¡æ¿**: Jinja2ï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰
- **CSS**: Bootstrap 5ï¼ˆCDNå¼•å…¥ï¼‰
- **JavaScript**: Vanilla JSï¼ˆæ— éœ€æ„å»ºï¼‰
- **å›¾è¡¨**: Chart.jsï¼ˆCDNå¼•å…¥ï¼‰

### 5.2 é¡¹ç›®ç»“æ„

```
tools/web_eeprom_viz/
â”œâ”€â”€ app.py                      # Flaskåº”ç”¨ä¸»å…¥å£
â”œâ”€â”€ eeprom_simulator.py         # EEPROMä»¿çœŸå¼•æ“
â”œâ”€â”€ nvm_simulator.py            # NvMè½»é‡ä»¿çœŸï¼šé˜Ÿåˆ—/çŠ¶æ€æœº/è°ƒåº¦/ä¸¤é˜¶æ®µæäº¤
â”œâ”€â”€ requirements.txt            # Pythonä¾èµ–
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ base.html               # åŸºç¡€æ¨¡æ¿
â”‚   â”œâ”€â”€ index.html              # é¦–é¡µ
â”‚   â”œâ”€â”€ physical.html           # ç‰©ç†ç»“æ„å¯è§†åŒ–
â”‚   â”œâ”€â”€ erase_write_demo.html   # æ“¦é™¤-å†™å…¥ä¾èµ–æ¼”ç¤º
â”‚   â”œâ”€â”€ write_amplification.html# å†™æ”¾å¤§æ¼”ç¤º
â”‚   â”œâ”€â”€ wear_leveling.html      # ç£¨æŸå‡è¡¡æ¼”ç¤º
â”‚   â”œâ”€â”€ bit_flip.html           # ä½ç¿»è½¬æ¼”ç¤º
â”‚   â”œâ”€â”€ nvm_queue.html          # NvMé˜Ÿåˆ—/çŠ¶æ€æœºæ—¶é—´è½´
â”‚   â”œâ”€â”€ writeall_consistency.html # WriteAllä¸¤é˜¶æ®µ+è„æ•°æ®æ¼”ç¤º
â”‚   â””â”€â”€ block_types.html        # Blockç±»å‹/æ¢å¤è·¯å¾„æ¼”ç¤º
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ custom.css          # è‡ªå®šä¹‰æ ·å¼
â”‚   â””â”€â”€ js/
â”‚       â”œâ”€â”€ chart-config.js     # Chart.jsé…ç½®
â”‚       â”œâ”€â”€ animations.js       # åŠ¨ç”»æ•ˆæœ
â”‚       â””â”€â”€ timeline.js         # é˜Ÿåˆ—/çŠ¶æ€æœº/èŠ‚æ‹æ—¶é—´è½´
â””â”€â”€ README.md                   # ä½¿ç”¨è¯´æ˜
```

### 5.3 åŸºç¡€æ¨¡æ¿ç¤ºä¾‹

```html
<!-- templates/base.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}EEPROMå¯è§†åŒ–ä»¿çœŸ{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
          rel="stylesheet">
    <link href="{{ url_for('static', filename='css/custom.css') }}" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">ğŸ”§ EEPROMå¯è§†åŒ–ä»¿çœŸ</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/physical">ç‰©ç†ç»“æ„</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/erase_write_demo">æ“¦é™¤-å†™å…¥ä¾èµ–</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/write_amplification">å†™æ”¾å¤§</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/wear_leveling">ç£¨æŸå‡è¡¡</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/bit_flip">ä½ç¿»è½¬æ•…éšœ</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        {% block content %}{% endblock %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js">
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>
```

### 5.4 é¡µé¢ç¤ºä¾‹ï¼ˆæ“¦é™¤-å†™å…¥æ¼”ç¤ºï¼‰

```html
<!-- templates/erase_write_demo.html -->
{% extends "base.html" %}

{% block title %}æ“¦é™¤-å†™å…¥ä¾èµ–æ¼”ç¤º - EEPROMå¯è§†åŒ–{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h4>åœºæ™¯1: æœªæ“¦é™¤ç›´æ¥å†™å…¥</h4>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label">é€‰æ‹©Page:</label>
                    <select id="pageSelect" class="form-select">
                        {% for page in pages %}
                        <option value="{{ page.page_id }}">Page #{{ page.page_id }}
                            ({{ page.state }}, æ“¦å†™{{ page.erase_count }}æ¬¡)</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">åç§»åœ°å€:</label>
                    <input type="number" id="offsetInput" class="form-control" value="0" min="0" max="255">
                </div>
                <div class="mb-3">
                    <label class="form-label">å†™å…¥æ•°æ® (HEX):</label>
                    <input type="text" id="dataInput" class="form-control" value="1234" maxlength="64">
                    <div class="form-text">ä¾‹å¦‚: 1234 è¡¨ç¤ºå†™å…¥ 0x12 0x34</div>
                </div>
                <button id="checkWriteBtn" class="btn btn-primary">
                    ğŸ” æ£€æŸ¥æ˜¯å¦å¯ä»¥å†™å…¥
                </button>
                <button id="forceWriteBtn" class="btn btn-warning ms-2" style="display:none">
                    âš ï¸ å¼ºåˆ¶å†™å…¥ï¼ˆä¼šå¤±è´¥ï¼‰
                </button>
            </div>
        </div>

        <div id="resultCard" class="card mt-3" style="display:none">
            <div class="card-header">æ£€æŸ¥ç»“æœ</div>
            <div class="card-body">
                <div id="resultContent"></div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h4>åœºæ™¯2: å…ˆæ“¦é™¤å†å†™å…¥</h4>
            </div>
            <div class="card-body">
                <p>æ­¥éª¤1: å…ˆæ“¦é™¤Page</p>
                <button id="eraseBtn" class="btn btn-danger mb-3">
                    ğŸ—‘ï¸ æ“¦é™¤Page #<span id="erasePageId">0</span>
                </button>

                <p>æ­¥éª¤2: å†å†™å…¥æ•°æ®</p>
                <button id="eraseAndWriteBtn" class="btn btn-success" disabled>
                    âœï¸ å†™å…¥æ•°æ®
                </button>

                <div id="successResult" class="alert alert-success mt-3" style="display:none">
                    <strong>âœ“ å†™å…¥æˆåŠŸï¼</strong>
                    <div id="successContent"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h4>ğŸ’¡ ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ</h4>
            </div>
            <div class="card-body">
                <h5>EEPROMçš„ç‰©ç†æœºåˆ¶:</h5>
                <ul>
                    <li>æ¯ä¸ªå­˜å‚¨å•å…ƒå¯ä»¥çœ‹ä½œä¸€ä¸ª"æµ®åŠ¨æ …ç”µå­é˜±"</li>
                    <li><strong>æ“¦é™¤æ“ä½œ</strong>ï¼ˆåŠ é«˜å‹ï¼‰ï¼šå°†ç”µå­æ³¨å…¥æ …æ â†’ æ•°æ®å˜1ï¼ˆå…¨FFï¼‰</li>
                    <li><strong>å†™å…¥æ“ä½œ</strong>ï¼ˆéš§ç©¿æ•ˆåº”ï¼‰ï¼šå°†ç”µå­æ‹‰å‡º â†’ 1å¯ä»¥å˜0</li>
                    <li><strong>å…³é”®é™åˆ¶</strong>ï¼šæ²¡æœ‰æ“¦é™¤ï¼Œ0æ— æ³•å˜1ï¼</li>
                </ul>
                <h5>ä½æ“ä½œç¤ºä¾‹:</h5>
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>å¯ä»¥å†™å…¥ï¼ˆ1â†’0ï¼‰:</strong></p>
                        <p>åŸå€¼: <code>0xFF</code> = <code>11111111</code></p>
                        <p>å†™å…¥: <code>0x00</code> = <code>00000000</code></p>
                        <p class="text-success">âœ“ æ‰€æœ‰ä½éƒ½æ˜¯1â†’0ï¼Œå¯ä»¥å†™å…¥</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>ä¸èƒ½å†™å…¥ï¼ˆ0â†’1éœ€è¦æ“¦é™¤ï¼‰:</strong></p>
                        <p>åŸå€¼: <code>0xAA</code> = <code>10101010</code></p>
                        <p>å†™å…¥: <code>0x55</code> = <code>01010101</code></p>
                        <p class="text-danger">âœ— ç¬¬1,3,5,7ä½éœ€è¦0â†’1ï¼Œå¿…é¡»å…ˆæ“¦é™¤</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const pageSelect = document.getElementById('pageSelect');
    const offsetInput = document.getElementById('offsetInput');
    const dataInput = document.getElementById('dataInput');
    const checkWriteBtn = document.getElementById('checkWriteBtn');
    const forceWriteBtn = document.getElementById('forceWriteBtn');
    const resultCard = document.getElementById('resultCard');
    const resultContent = document.getElementById('resultContent');
    const eraseBtn = document.getElementById('eraseBtn');
    const erasePageId = document.getElementById('erasePageId');
    const eraseAndWriteBtn = document.getElementById('eraseAndWriteBtn');
    const successResult = document.getElementById('successResult');
    const successContent = document.getElementById('successContent');

    let currentData = null;

    // æ›´æ–°æ“¦é™¤æŒ‰é’®çš„Page ID
    pageSelect.addEventListener('change', function() {
        erasePageId.textContent = this.value;
    });

    // æ£€æŸ¥å†™å…¥æŒ‰é’®
    checkWriteBtn.addEventListener('click', async function() {
        const pageId = parseInt(pageSelect.value);
        const offset = parseInt(offsetInput.value);
        const dataHex = dataInput.value;

        try {
            const response = await fetch('/api/demo_write_check', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({page_id: pageId, offset: offset, data_hex: dataHex})
            });

            currentData = await response.json();

            resultCard.style.display = 'block';

            if (currentData.can_write) {
                resultContent.innerHTML = `
                    <div class="alert alert-success">
                        <h5>âœ“ å¯ä»¥ç›´æ¥å†™å…¥</h5>
                        ${currentData.details.map(d => `
                            <p>åœ°å€ 0x${d.offset.toString(16).padStart(2,'0').toUpperCase()}:
                            <code>${d.binary_current}</code> â†’ <code>${d.binary_new}</code></p>
                        `).join('')}
                    </div>
                `;
                forceWriteBtn.style.display = 'none';
            } else {
                resultContent.innerHTML = `
                    <div class="alert alert-danger">
                        <h5>âœ— ä¸èƒ½ç›´æ¥å†™å…¥ï¼Œéœ€è¦å…ˆæ“¦é™¤</h5>
                        ${currentData.details.filter(d => !d.can_write).map(d => `
                            <p><strong>åœ°å€ 0x${d.offset.toString(16).padStart(2,'0').toUpperCase()}:</strong></p>
                            <p>åŸå€¼: <code>${d.current}</code> = <code>${d.binary_current}</code></p>
                            <p>å†™å…¥: <code>${d.new}</code> = <code>${d.binary_new}</code></p>
                            <p class="text-danger">${d.reason}</p>
                        `).join('')}
                    </div>
                `;
                forceWriteBtn.style.display = 'inline-block';
            }

            // æ¿€æ´»æ“¦é™¤-å†™å…¥æµç¨‹
            eraseAndWriteBtn.disabled = false;

        } catch (error) {
            console.error('Error:', error);
            alert('æ£€æŸ¥å¤±è´¥: ' + error);
        }
    });

    // æ“¦é™¤æŒ‰é’®
    eraseBtn.addEventListener('click', async function() {
        const pageId = parseInt(pageSelect.value);

        try {
            const response = await fetch(`/api/page/${pageId}/erase`, {
                method: 'POST'
            });
            const result = await response.json();

            if (result.success) {
                eraseBtn.textContent = `âœ“ å·²æ“¦é™¤Page #${pageId}`;
                eraseBtn.disabled = true;
                eraseBtn.classList.remove('btn-danger');
                eraseBtn.classList.add('btn-success');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('æ“¦é™¤å¤±è´¥: ' + error);
        }
    });

    // æ“¦é™¤å¹¶å†™å…¥æŒ‰é’®
    eraseAndWriteBtn.addEventListener('click', async function() {
        const pageId = parseInt(pageSelect.value);
        const offset = parseInt(offsetInput.value);
        const dataHex = dataInput.value;

        try {
            const response = await fetch('/api/demo_erase_and_write', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({page_id: pageId, offset: offset, data_hex: dataHex})
            });

            const result = await response.json();

            successResult.style.display = 'block';
            successContent.innerHTML = `
                <p>Page #${pageId} å·²æ“¦é™¤å¹¶æˆåŠŸå†™å…¥æ•°æ®</p>
                <p>åœ°å€: 0x${pageId * 256 + offset}</p>
                <p>æ•°æ®: ${dataHex}</p>
            `;

        } catch (error) {
            console.error('Error:', error);
            alert('å†™å…¥å¤±è´¥: ' + error);
        }
    });
});
</script>
{% endblock %}
```

---

## 6. å®æ–½è·¯çº¿å›¾

### Phase 1: MVP (1å‘¨)

**ç›®æ ‡**: å®Œæˆæ ¸å¿ƒEEPROMä»¿çœŸã€æ“¦é™¤-å†™å…¥ä¾èµ–ã€NvMé˜Ÿåˆ—/çŠ¶æ€æœºæ—¶é—´è½´åŸºç¡€

- [ ] Day 1-2: æ­å»ºFlaské¡¹ç›®ï¼Œå®ŒæˆEEPROMä»¿çœŸå¼•æ“
- [ ] Day 3: å®Œæˆç‰©ç†ç»“æ„å¯è§†åŒ–é¡µé¢
- [ ] Day 4: å®Œæˆæ“¦é™¤-å†™å…¥ä¾èµ–æ¼”ç¤º
- [ ] Day 5-7: è½åœ°NvMè½»é‡ä»¿çœŸï¼ˆJobé˜Ÿåˆ—/çŠ¶æ€æœº/èŠ‚æ‹ï¼‰+ æ—¶é—´è½´å¯è§†åŒ–

**éªŒæ”¶æ ‡å‡†**:
- æµè§ˆå™¨å¯è§Pageå¸ƒå±€ï¼Œæ“¦é™¤/å†™å…¥æµç¨‹å¯äº¤äº’
- æœªæ“¦é™¤å†™å…¥å¤±è´¥ã€æ“¦é™¤åå†™å…¥æˆåŠŸçš„å¯¹æ¯”å¯è§†åŒ–
- NvMé˜Ÿåˆ—å¯å…¥é˜Ÿ/å‡ºé˜Ÿï¼ŒçŠ¶æ€æœºè½¨è¿¹å¯è§†åŒ–ï¼Œæ”¯æŒå€é€Ÿåˆ‡æ¢

### Phase 2: å¢å¼ºåŠŸèƒ½ (1å‘¨)

- [ ] å†™æ”¾å¤§æ¼”ç¤º
- [ ] ç£¨æŸå‡è¡¡æ¼”ç¤º
- [ ] ä½ç¿»è½¬æ•…éšœæ¼”ç¤º
- [ ] WriteAllä¸¤é˜¶æ®µ+è„æ•°æ®æ£€æµ‹æ¼”ç¤º
- [ ] Blockç±»å‹/æ¢å¤è·¯å¾„æ¼”ç¤º
- [ ] UIåŠ¨ç”»ä¸æ—¶é—´è½´ä¼˜åŒ–

### Phase 3: å®Œå–„ä¸ä¼˜åŒ– (3å¤©)

- [ ] å¤šè¯­è¨€æ”¯æŒï¼ˆä¸­è‹±æ–‡ï¼‰
- [ ] ç”¨æˆ·æ‰‹å†Œä¸æ•™ç¨‹
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] Dockerå®¹å™¨åŒ–éƒ¨ç½²

---

## 7. éƒ¨ç½²ä¸ä½¿ç”¨

### 7.1 æœ¬åœ°è¿è¡Œ

```bash
# 1. å®‰è£…ä¾èµ–
cd tools/web_eeprom_viz
pip install -r requirements.txt

# 2. å¯åŠ¨æœåŠ¡å™¨
python app.py

# 3. æµè§ˆå™¨è®¿é—®
# http://localhost:5000
```

### 7.2 Dockeréƒ¨ç½²

```dockerfile
# tools/web_eeprom_viz/Dockerfile
FROM python:3.11-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 5000
CMD ["python", "app.py"]
```

```bash
# æ„å»ºå¹¶è¿è¡Œ
docker build -t eeprom-viz .
docker run -p 5000:5000 eeprom-viz
```

---

## 8. æ€»ç»“

### 8.1 è®¾è®¡ç‰¹ç‚¹

âœ… **åŒé‡å®šä½** - åˆå­¦è€…å­¦ä¹ è·¯å¾„ + å·¥ç¨‹å¸ˆè°ƒè¯•å·¥å…·
âœ… **èšç„¦EEPROMåŸç†** - ä¸æ˜¯å±•ç¤ºé¡¹ç›®æ¶æ„ï¼Œè€Œæ˜¯è§£é‡ŠEEPROMæœ¬èº«
âœ… **æç®€æŠ€æœ¯æ ˆ** - Flask + Bootstrapï¼Œæ— å¤æ‚å‰ç«¯æ¡†æ¶
âœ… **äº¤äº’å¼å­¦ä¹ ** - åŠ¨æ‰‹å®éªŒï¼Œè€Œéè¢«åŠ¨è§‚çœ‹
âœ… **å¯è§†åŒ–æŠ½è±¡æ¦‚å¿µ** - Pageæ“¦é™¤ã€å†™æ”¾å¤§ã€ç£¨æŸå‡è¡¡ç­‰
âœ… **å®Œæ•´NvMä»¿çœŸ** - é˜Ÿåˆ—/çŠ¶æ€æœº/ä¸¤é˜¶æ®µæäº¤/Blockç±»å‹å…¨è¦†ç›–
âœ… **å¿«é€Ÿå¼€å‘** - MVPå¯åœ¨2-3å‘¨å†…å®Œæˆ

### 8.2 ä¸å…¶ä»–æ–‡æ¡£çš„å…³ç³»

```
æœ¬æ–‡æ¡£å®šä½:
â”œâ”€â”€ ç¬¬1ç« "EEPROMåŸºç¡€çŸ¥è¯†" â†’ æä¾›ç†è®ºåŸºç¡€
â”œâ”€â”€ ç¬¬2ç« "NvMæ¶æ„è®¾è®¡" â†’ NvMé˜Ÿåˆ—/çŠ¶æ€æœº/è°ƒåº¦æœºåˆ¶è¯¦è§£
â”œâ”€â”€ ç¬¬3ç« "Blockç®¡ç†æœºåˆ¶" â†’ Native/Redundant/Datasetç±»å‹å¯¹æ¯”
â”œâ”€â”€ æœ¬æ–‡"Webå¯è§†åŒ–" â†’ æä¾›ç›´è§‚æ¼”ç¤ºã€äº¤äº’å®éªŒå’Œè°ƒè¯•å·¥å…·
â””â”€â”€ å…¶ä»–è®¾è®¡æ–‡æ¡£ â†’ èšç„¦é¡¹ç›®å®ç°ç»†èŠ‚
```

### 8.3 é€‚ç”¨åœºæ™¯ä¸ç”¨æˆ·

| åœºæ™¯ | ç”¨æˆ·ç±»å‹ | æ ¸å¿ƒéœ€æ±‚ | æœ¬æ–‡æ¡£æä¾›çš„è§£å†³æ–¹æ¡ˆ |
|-----|---------|---------|---------------------|
| **è¯¾å ‚æ•™å­¦** | å­¦ç”Ÿ/æ•™å¸ˆ | å¿«é€Ÿç†è§£EEPROMåŸç† | ğŸŸ¢ å¿«é€Ÿå…¥é—¨è·¯å¾„ï¼ˆ30åˆ†é’Ÿï¼‰ |
| **è‡ªä¸»å­¦ä¹ ** | åˆå­¦è€… | å¾ªåºæ¸è¿›æŒæ¡çŸ¥è¯† | ğŸŸ¡ æ ‡å‡†å­¦ä¹ è·¯å¾„ï¼ˆ2å°æ—¶ï¼‰ |
| **é¡¹ç›®å¼€å‘** | åµŒå…¥å¼å·¥ç¨‹å¸ˆ | è°ƒè¯•NvMé—®é¢˜ | ğŸ”§ è°ƒè¯•å·¥ç¨‹å¸ˆæ¨¡å¼ |
| **æ•…éšœè¯Šæ–­** | æµ‹è¯•å·¥ç¨‹å¸ˆ | æ³¨å…¥å’Œåˆ†ææ•…éšœ | âš ï¸ æ•…éšœæ³¨å…¥ç³»ç»Ÿ + è¯Šæ–­åŠ©æ‰‹ |
| **æ€§èƒ½ä¼˜åŒ–** | ç³»ç»Ÿæ¶æ„å¸ˆ | ç“¶é¢ˆåˆ†æä¸è°ƒä¼˜ | ğŸ“Š å®æ—¶æ€§èƒ½ç›‘æ§ + æ€§èƒ½åˆ†æ |

### 8.4 é¢„æœŸå­¦ä¹ æ•ˆæœ

é€šè¿‡æœ¬Webå¯è§†åŒ–å¹³å°ï¼š

**åˆå­¦è€…**èƒ½å¤Ÿï¼š
- **30åˆ†é’Ÿå†…** ç†è§£EEPROMçš„æ ¸å¿ƒç‰©ç†ç‰¹æ€§ï¼ˆPageã€æ“¦é™¤-å†™å…¥ä¾èµ–ï¼‰
- **2å°æ—¶å†…** æŒæ¡NvMé˜Ÿåˆ—ã€çŠ¶æ€æœºã€WriteAllä¸€è‡´æ€§ç­‰æ ¸å¿ƒæ¦‚å¿µ
- **äº²æ‰‹å®éªŒ** å†™æ”¾å¤§ã€ç£¨æŸå‡è¡¡ã€æ•…éšœæ¢å¤ç­‰å…³é”®åœºæ™¯
- **å»ºç«‹ç›´è§‰** ä¸ºåç»­æ·±å…¥å­¦ä¹ NvMæ¶æ„æ‰“ä¸‹åšå®åŸºç¡€

**å·¥ç¨‹å¸ˆ**èƒ½å¤Ÿï¼š
- **å®æ—¶ç›‘æ§** NvMé˜Ÿåˆ—é•¿åº¦ã€å“åº”æ—¶é—´ã€èµ„æºåˆ©ç”¨ç‡
- **å¿«é€Ÿè¯Šæ–­** é˜Ÿåˆ—å †ç§¯ã€è¶…æ—¶ã€é‡è¯•å¤±è´¥ç­‰å¸¸è§é—®é¢˜
- **æ•…éšœå¤ç°** é€šè¿‡æ•…éšœæ³¨å…¥ç³»ç»Ÿå¤ç°å’Œåˆ†æçº¿ä¸Šé—®é¢˜
- **æ€§èƒ½è°ƒä¼˜** åŸºäºæ•°æ®é©±åŠ¨çš„ä¼˜åŒ–å»ºè®®å’Œå¯¹æ¯”å®éªŒ

### 8.5 æ–‡æ¡£è¡¥å……è¯´æ˜

æœ¬v3.0ç‰ˆæœ¬ç›¸æ¯”v2.0çš„ä¸»è¦è¡¥å……ï¼š

**æ–°å¢å†…å®¹ (çº¦1500è¡Œ)**:
1. **å®Œæ•´çš„NvMæ ¸å¿ƒå®ç°** (æ¨¡å—6-8)
   - `nvm_simulator.py`å®Œæ•´ä»£ç ï¼ˆ500+è¡Œï¼‰
   - Jobé˜Ÿåˆ—ã€çŠ¶æ€æœºã€è™šæ‹Ÿè°ƒåº¦å™¨å®ç°
   - WriteAllä¸¤é˜¶æ®µæäº¤ä»¿çœŸå™¨
   - Blockç±»å‹ä»¿çœŸå™¨ï¼ˆNative/Redundant/Datasetï¼‰

2. **äº¤äº’å¼æ•™ç¨‹ç³»ç»Ÿ** (ç¬¬4ç« )
   - 3æ¡å­¦ä¹ è·¯å¾„ï¼ˆå¿«é€Ÿ30åˆ†é’Ÿã€æ ‡å‡†2å°æ—¶ã€ä¸“å®¶4å°æ—¶ï¼‰
   - æ£€æŸ¥ç‚¹æœºåˆ¶ä¸è¿›åº¦ä¿å­˜
   - å®Œæ•´çš„`TutorialManager`å®ç°
   - æ•™ç¨‹å‰ç«¯æ¨¡æ¿ç¤ºä¾‹

3. **è°ƒè¯•å·¥ç¨‹å¸ˆæ¨¡å¼** (ç¬¬5ç« )
   - å®æ—¶æ€§èƒ½ç›‘æ§é¢æ¿
   - æ™ºèƒ½è¯Šæ–­åŠ©æ‰‹ï¼ˆè‡ªåŠ¨åˆ†æ+å»ºè®®ï¼‰
   - æ•…éšœæ³¨å…¥ç³»ç»Ÿ
   - æ—¥å¿—æŸ¥çœ‹å™¨ä¸å¿«ç…§å›æ”¾
   - å®Œæ•´çš„`DebugManager`å®ç°

**ä»£ç ç»Ÿè®¡**:
- åç«¯Pythonä»£ç ï¼šçº¦1200è¡Œ
- å‰ç«¯HTML/JSæ¨¡æ¿ï¼šçº¦800è¡Œ
- æ¶æ„è®¾è®¡ä¸APIè§„èŒƒï¼šçº¦500è¡Œ
- æ€»è®¡ï¼šçº¦2500è¡Œå®ç°ä»£ç ä¸è®¾è®¡

**å®æ–½å·¥ä½œé‡ä¼°ç®—**:
- Phase 1 (MVP): 2-3å‘¨ï¼ˆEEPROMåŸºç¡€ + NvMé˜Ÿåˆ—/çŠ¶æ€æœºï¼‰
- Phase 2 (å¢å¼º): 1-2å‘¨ï¼ˆWriteAll + Blockç±»å‹ + æ•…éšœæ³¨å…¥ï¼‰
- Phase 3 (å®Œå–„): 1å‘¨ï¼ˆæ•™ç¨‹ç³»ç»Ÿ + è°ƒè¯•æ¨¡å¼ + UIä¼˜åŒ–ï¼‰
- **æ€»è®¡**: 4-6å‘¨å®Œæˆå®Œæ•´åŠŸèƒ½

---

**æ–‡æ¡£ç‰ˆæœ¬**: v3.0
**æ›´æ–°æ—¥æœŸ**: 2026-01-03
**ä½œè€…**: åŸºäºeepromSimé¡¹ç›®è¡¥å……å®Œå–„
**çŠ¶æ€**: âœ… å®Œæ•´ç‰ˆ - å…¼é¡¾åˆå­¦è€…å­¦ä¹ ä¸å·¥ç¨‹å¸ˆè°ƒè¯•éœ€æ±‚

**å˜æ›´è®°å½•**:
- v1.0: åˆå§‹ç‰ˆæœ¬ï¼ˆä»…EEPROMç‰©ç†ç‰¹æ€§ï¼‰
- v2.0: é‡æ–°å®šä½ï¼ˆèšç„¦EEPROMåŸç† + NvMæ ¸å¿ƒè¡Œä¸ºï¼‰
- v3.0: å®Œæ•´è¡¥å……ï¼ˆå­¦ä¹ è·¯å¾„ + è°ƒè¯•å·¥å…· + å®Œæ•´ä»£ç å®ç°ï¼‰
